/*! )°(, equolo - https://github.com/equolo/equolo.org */
/*@cc_on
(function(f){
window.setTimeout=f(window.setTimeout);
window.setInterval=f(window.setInterval);
})(function(f){return function(c,t,a){a=[].slice.call(arguments,2);return f(function(){c.apply(this,a)},t)}});
@*/
var
IEMobile=/*@cc_on/\bIEMobile\b/.test(navigator.userAgent)||@*/false,
IE9Mobile=/*@cc_on(IEMobile&&@_jscript_version<10)||@*/false,
IE10Mobile=/*@cc_on(IEMobile&&@_jscript_version/10>=1)||@*/false
;
IE9Mobile&&document.write('<link rel="stylesheet" href="css/IE9Mobile.css"/><script src="js/IE9Mobile.js"></script>');(function(d){
/*! display v0.1.3 - MIT license */
;var e=function(s){var j=s.Math,n=j.abs,u=j.max,r=j.min,y=s.Infinity,h=s.screen||y,g=d.matchMedia,o="addEventListener",x=s.document.documentElement,k=/\bMobile\b/.test(navigator.userAgent),p={change:[]},t={width:0,height:0,ratio:0,on:function(z,A){p[z].push(A)}},v=p.change.forEach||function(B,z){for(var A=0;A<this.length;A++){B.call(z,this[A],A,this)}},l;function m(z){z.call(t,t.width,t.height)}function q(z){if(l){clearTimeout(l)}l=setTimeout(i,300,z)}function i(F){l=0;var A=s.devicePixelRatio||1,E="orientation" in this,G=E?n(this.orientation||0)===90:!!g&&g("(orientation:landscape)").matches,B=h.width,D=h.height,C=r(s.innerWidth||x.clientWidth,A<1?y:((k&&G?u(B,D):B)||y)),z=r(s.innerHeight||x.clientHeight,A<1?y:((k&&G?r(B,D):D)||y));if(C!==t.width||z!==t.height){t.width=C;t.height=z;v.call(p.change,m)}}if(o in s){s[o]("orientationchange",q,true);s[o]("resize",q,true);try{h[o]("orientationchange",q,true)}catch(w){}}else{s.attachEvent("onresize",i)}i.call(s);t.ratio=s.devicePixelRatio||h.width/t.width||(h.deviceXDPI||1)/(h.logicalXDPI||1);return t}(d);(function(i,g,h){"indexOf" in i||(i.indexOf=function(j){for(var k=this.length;k--&&this[k]!==j;){}return k});"bind" in g||(g.bind=function(m){var l=this,k=i.slice,j=k.call(arguments,1);return function(){return l.apply(m,j.concat(k.call(arguments)))}});"trim" in h||(h.trim=function(){return this.replace(/^[^\S]+|[^\S]+$/g,"")})}(Array.prototype,Function.prototype,String.prototype));var c,b=c=function(p,i){function x(F){for(var A=F.length,G=n(A?F[0]:{}),B=G.length,H=p(A*B),E=0,D=0,C,z;E<A;++E){for(z=F[E],C=0;C<B;H[D++]=z[G[C++]]){}}return k.call([B],G,H)}function v(D){for(var E=D.length,A=D[0],z=p(((E-A-1)/A)||0),C=1+A,B=0,G,F;C<E;){for(z[B++]=(F={}),G=0;G<A;F[D[++G]]=D[C++]){}}return z}function j(A){return function z(G){for(var I=this,H=G,E=0,F=I.length,C,B,D;E<F;++E){if(m(D=H[B=I[E]])){C=E+1;H[B]=C<F?y.call(D,A,I.slice(C)):A(D)}H=H[B]}return G}}function l(A){return function z(H,F){for(var C=m(H),B=k.call(h,H),G=k.call(h,F),D=0,E=G.length;D<E;++D){B=y.call(B,A,G[D].split("."))}return C?B:B[0]}}function t(A,z){return z?o(A,z):x(A)}function g(z,A){return A?s(z,A):v(z)}function r(C,z,B,A){return w(t(C,A),z,B)}function q(A,z,B){return g(u(A,z),B)}var h=[],k=h.concat,n=Object.keys||function(B){var A=[],z;for(z in B){B.hasOwnProperty(z)&&A.push(z)}return A},m=p.isArray||(function(A,B){B=A.call(h);return function z(C){return A.call(C)==B}}({}.toString)),y=h.map||function(D,C){for(var A=this,B=A.length,z=p(B);B--;z[B]=D.call(C,A[B],B,A)){}return z},o=l(j(x)),s=l(j(v)),w=i.stringify,u=i.parse;return{pack:t,parse:q,stringify:r,unpack:g}}(Array,JSON);
/*! (C) WebReflection Mit Style License */
(function(z){function F(h){return typeof h=="string"?z.document.createTextNode(h):h}function m(p){if(p.length===1){return F(p[0])}for(var o=z.document.createDocumentFragment(),h=x.call(p),l=0;l<p.length;l++){o.appendChild(F(h[l]))}return o}for(var g,w,G,k=/^\s+|\s+$/g,E=/\s+/,C=" ",y=function(h,i){return this.contains(h)?i||this.remove(h):i&&this.add(h),!!i},q=(z.Element||z.Node||z.HTMLElement).prototype,B=["prepend",function(){var h=this.firstChild,i=m(arguments);h?this.insertBefore(i,h):this.appendChild(i)},"append",function(){this.appendChild(m(arguments))},"before",function(){var h=this.parentNode;h&&h.insertBefore(m(arguments),this)},"after",function(){var l=this.parentNode,n=this.nextSibling,h=m(arguments);l&&(n?l.insertBefore(h,n):l.appendChild(h))},"replace",function(){var h=this.parentNode;h&&h.replaceChild(m(arguments),this)},"remove",function(){var h=this.parentNode;h&&h.removeChild(this)}],x=B.slice,j=B.length;j;j-=2){g=B[j-2],g in q||(q[g]=B[j-1])}"classList" in document.documentElement?(G=document.createElement("div").classList,G.add("a","b"),"a b"!=G&&(q=G.constructor.prototype,"add" in q||(q=z.DOMTokenList.prototype),w=function(h){return function(){var i=0;while(i<arguments.length){h.call(this,arguments[i++])}}},q.add=w(q.add),q.remove=w(q.remove),q.toggle=y)):(w=function(h){if(!h){throw"SyntaxError"}if(E.test(h)){throw"InvalidCharacterError"}return h},G=function(i){var h=i.className.replace(k,"");h.length&&B.push.apply(this,h.split(E)),this._=i},G.prototype={length:0,add:function(){for(var h=0,i;h<arguments.length;h++){i=arguments[h],this.contains(i)||B.push.call(this,g)}this._.className=""+this},contains:function(h){return function(i){return j=h.call(this,g=w(i)),-1<j}}([].indexOf||function(h){j=this.length;while(j--&&this[j]!==h){}return j}),item:function(h){return this[h]||null},remove:function(){for(var h=0,i;h<arguments.length;h++){i=arguments[h],this.contains(i)&&B.splice.call(this,j,1)}this._.className=""+this},toggle:y,toString:function D(){return B.join.call(this,C)}},(Object.defineProperty||function(i,h,l){i.__defineGetter__(h,l.get)})(q,"classList",{get:function(){return new G(this)},set:function(){}}));try{new z.CustomEvent("?")}catch(A){z.CustomEvent=function(l,h){function o(t,p){var r=document.createEvent(l);if(typeof t!="string"){throw new Error("An event name must be provided")}return l=="Event"&&(r.initCustomEvent=i),p==null&&(p=h),r.initCustomEvent(t,p.bubbles,p.cancelable,p.detail),r}function i(u,p,v,s){this.initEvent(u,p,v),this.detail=s}return o}(z.CustomEvent?"CustomEvent":"Event",{bubbles:!1,cancelable:!1,detail:null})}})(d);
/*! (C) Andrea Giammarchi Mit Style License */
(function(aa){function H(){return{l:{},m:[],b:[]}}function q(h){var g=H();return ac.value=g,O(h,Z,ac),ac.value=null,g}function B(h,g,i){typeof g=="function"?g.apply(h,i):g.handleEvent.apply(g,i)}function j(h,g,i){i&&A(this,"detail",i),A(this,"type",g),A(this,"target",h),A(this,"timeStamp",R())}if(aa.eddy){return}aa.eddy=!0;var I=Array.prototype,Q=aa.prototype,M=j.prototype,W=Q.hasOwnProperty,J=I.push,P=I.slice,G=I.unshift,ae="toLocaleString",Z={toLocaleString:1}.propertyIsEnumerable(ae)?"_@eddy"+Math.random():ae,U=Z===ae,ac=(aa.create||aa)(null),X=[],O=U?function(h,g,i){h[g]=i.value}:aa.defineProperty,ab=function(h){var g=this;return function(){return g.apply(h,arguments)}},F=I.indexOf||function(h){var g=this.length;while(g--&&this[g]!==h){}return g},R=Date.now||function(){return(new Date).getTime()},Y={boundTo:function(i){var m=W.call(this,Z)?this[Z]:q(this),k=m.m,l=m.b,h=typeof i=="string"?this[i]:i,g=F.call(k,h);return g<0?l[J.call(k,h)-1]=ab.call(h,this):l[g]},emit:function(k){var v=W.call(this,Z),o=v&&this[Z].l,m=v&&W.call(o,k),i=m&&o[k],h=m&&P.call(arguments,1),g=0,p=m?i.length:g;while(g<p){B(this,i[g++],h)}return m},listeners:function(g){return W.call(this,Z)&&W.call(this[Z].l,g)&&this[Z].l[g].slice()||[]},off:function(h,m){var k=W.call(this,Z),i=k&&this[Z].l,l=k&&W.call(i,h)&&i[h],g;return l&&(g=F.call(l,m),-1<g&&(l.splice(g,1),l.length||delete i[h])),this},on:function(i,p,k){var m=W.call(this,Z),h=(m?this[Z]:q(this)).l,g=m&&W.call(h,i)?h[i]:h[i]=[];return F.call(g,p)<0&&(k?G:J).call(g,p),this},once:function(h,m,l){var g=function(i){k.off(h,g,l),B(k,m,arguments)},k=this;return k.on(h,g,l)},trigger:function(N,i){var S=W.call(this,Z),h=S&&this[Z].l,E=typeof N=="string",y=E?N:N.type,r=S&&W.call(h,y),x=r&&h[y].slice(0),g=E?new j(this,y,i):N,w=0,C=r?x.length:w,k=!(g instanceof j);k&&(g._active=!0,g.stopImmediatePropagation=M.stopImmediatePropagation),g.currentTarget=this,X[0]=g;while(g._active&&w<C){B(this,x[w++],X)}return k&&(delete g._active,delete g.stopImmediatePropagation),!g.defaultPrevented}},A=function(h,g,i){W.call(h,g)||(h[g]=i)},ad=!1,D;M.defaultPrevented=!1,M._active=M.cancelable=!0,M.preventDefault=function(){this.defaultPrevented=!0},M.stopImmediatePropagation=function(){this._active=!1};for(D in Y){W.call(Y,D)&&O(Q,D,{enumerable:!1,configurable:!0,writable:!0,value:Y[D]})}(function(h){function i(k){function l(m){m[k].apply(m,this)}return function(){return h.call(this,l,arguments),this}}for(var g in Y){Y.hasOwnProperty(g)&&!/^listeners|boundTo$/.test(g)&&O(I,g,{enumerable:!1,configurable:!0,writable:!0,value:i(g)})}})(I.forEach);var z={boundTo:Y.boundTo,data:function V(h,g){var i="dataset" in this;return arguments.length<2?i?this.dataset[h]:(g=this.getAttribute("data-"+h.replace(V.gre||(V.gre=/-[a-z]/g),V.gplace||(V.gplace=function(l,k){return k.toUpperCase()}))))==null?void 0:g:i?g==null?delete this.dataset[h]:(this.dataset[h]=g,g):(V.sre||(V.sre=/([a-z])([A-Z])/g,V.splace=function(l,k,m){return k+"-"+m.toLowerCase()}),h="data-"+h.replace(V.sre,V.splace),g==null?!this.removeAttribute(h):(this.setAttribute(h,g),g))},emit:function(h){var g=new CustomEvent(h);return g.arguments=I.slice.call(arguments,1),this.dispatchEvent(g)},listeners:function(g){return[]},off:function(h,g,i){return this.removeEventListener(h,g,i),this},on:function(h,g,i){return this.addEventListener(h,g,i),this},once:Y.once,trigger:function(h,m){var l=typeof h=="string",g=l?h:h.type,k=l?new CustomEvent(g,(ac.detail=m,ac)):h;return ac.detail=null,j.call(k,this,g),this.dispatchEvent(k)}};ac.cancelable=!0,ac.bubbles=!0;try{document.createEvent("Event").target=document}catch(K){ad=!0,A=function(i,g,k){if(!W.call(i,g)){try{i[g]=k}catch(h){}}}}(function(m){var i=m.Window,v=i?i.prototype:m,l=(m.Node||m.Element||m.HTMLElement).prototype,k=(m.Document||m.HTMLDocument).prototype,p=(m.XMLHttpRequest||function(){}).prototype,h,g;for(h in z){W.call(z,h)&&(g={enumerable:!1,configurable:!0,writable:!0,value:z[h]},O(v,h,g),O(l,h,g),O(k,h,g),h!=="data"&&O(p,h,g))}})(d)})(Object);d.$=function(g){return function(i,h){return g.slice.call(g.concat(h||document)[0].querySelectorAll(i))}}([]);
/*! SimpleKinetic v0.1.1 - MIT license */
;var a=function(h){var p=h.isNaN,i=h.Math,w=i.abs,v=i.round,s=i.sqrt,o=h.setInterval,t=h.clearInterval,k=0.2,u=9,q=1000/60,n=j.prototype;function j(x){for(var y in x){if(/^on|context|interval/.test(y)){this[y]=x[y]}}}n.init=function(O,N,E,C,H,F){var P=m(this),D=(w(E)<1?0:E)*(H?1:u),J=(w(C)<1?0:C)*(F?1:u),B=D*D,I=J*J,A=s(B+I),z=D/A,G=J/A,M,K;P.cancel(P._cx,P._cy);if(!(p(z)||p(G))){P._a=o(l,P.interval||q,P);P._t=0;P._d=A;P._sx=P._cx=O;P._sy=P._cy=N;P._xa=z;P._ya=G;M=v(O+A*z);K=v(N+A*G);P._ex=M;P._ey=K;if((O!==M||N!==K)&&P.start(O,N,0,0,M,K)!==false){return true}m(P._a)}return false};n.start=r("start");n.move=r("move");n.end=r("end");n.cancel=function(z,x,A,y,C,B){if(this._a){m(this).oncancel.call(this.context||this,z,x,A,y,C,B)}};n.onstart=n.onmove=n.onend=n.oncancel=function(z,x,A,y,C,B){};function m(x){t(x._a);x._a=0;return x}function r(x){x="on"+x;return function(A,y,B,z,D,C){return this[x].call(this.context||this,A,y,B,z,D,C)}}function l(A){var F=(A._t+=(A._d-A._t)*k),z=v(A._sx+F*A._xa),G=v(A._sy+F*A._ya),E=A._ex,C=A._ey,D=z-A._cx,B=G-A._cy;if(z===E&&G===C){m(A).end(E,C,D,B,E,C)}else{A.move(z,G,D,B,E,C);A._cx=z;A._cy=G}}var g=o(function(x){t(g);if(!x){o=function(A,z,y){return h.setInterval(function(){A(y)},z)}}},0,1);return j}(this);var f=function(h){var i=h.getContext("2d"),l={question:61736,"shopping-cart":61562,gift:61547,food:61685,home:61461,glass:61440,briefcase:61617,group:61632,truck:61649,"map-marker":32},g={};function k(o,q,p){i.beginPath();i.arc(o,q,p,0,Math.PI*2,true);i.closePath();i.fill()}function j(p,o){i.clearRect(0,0,h.width,h.height);h.width=h.height=o;i.textBaseline="bottom";i.fillStyle="rgb(25,138,138)";k(o/2,o/2.5,o/2.5);m(o,o/4.9);i.fillStyle="rgb(240,240,240)";k(o/2,o/2.5,o/2.8);i.font=i.mozTextStyle=Math.round(o/2)+"px FontAwesome";i.translate((h.width-(i.measureText||i.mozMeasureText).call(i,p).width)/2,0);i.fillStyle="rgb(40,104,104)";i.fillText(p,0,o/1.5);return h.toDataURL()}function m(o,p){i.beginPath();i.moveTo(o/2,o);i.lineTo(p,o/1.5);i.lineTo(o-p,o/1.5);i.lineTo(o/2,o);i.closePath();i.fill()}return function n(q,o,p){return g[q+o+p]||(g[q+o+p]=j(String.fromCharCode(l[q]),Math.round(o*(p||(typeof e==="undefined"?1:e.ratio)))))}}(document.createElement("canvas"));document.once("DOMContentLoaded",function(){var n=/^[^@]+?@[^\1@]+\.([a-z]{2,})$/,x=/^-?\d+(?:\.\d+)?$/,j=0,K=0,r="_JSONP",q=$("fieldset#step-4 fieldset.address > legend > i")[0],i={no:"icon-angle-down",ok:"icon-ok",error:"icon-exclamation-sign",searching:"icon-refresh icon-spin"},C={},A={handleEvent:function(W){var V=W.type,U;if("_type" in this){U=this._type+"-terminate";if(U in this){this[U](W)}}this._type=V;U=V+"-init";if(U in this){this[U](W)}E.enable($("fieldset#"+V)[0]);this[V](W)},"step-1":function(W){var V=$("fieldset#"+W.type)[0],U=$("select",V);U.once("change",function(){location.href=location.href.split(/[\?#]/)[0]+"?lang="+this.value});this.trigger("step-2")},"step-2":function(W){var V=$("fieldset#"+W.type)[0],U=$("input",V)[0];this.on("email:verified",O);U.on("keyup",this.boundTo(Q));U.emit("keyup")},"step-3":function(af){var ak=af.detail,ai=$("fieldset"),ag=$("fieldset#"+af.type)[0],V=$("select[name=activity]",ag)[0],ac=$("button[name=add]",ag)[0],aj=$("button[name=remove]",ag)[0],ad=$("button.next",ag)[0],am=$("input[name=name]",ag)[0],ae=$("textarea[name=description]",ag)[0],al=$("select[name=lang]",ag)[0],Y=$("div.lang > p > span",ag)[0],Z=$("ul",ag)[0],ab=$("div.criteria input",ag),W=ab.shift(),X=ab.shift(),U=function(ao){var an=Z.appendChild(document.createElement("li")),ap=an.appendChild(document.createElement("strong"));ap.append("√");an.append(ap);an.append(" "+G(al,ao))},aa=function(){aj.disabled=!V.options.length;ad.disabled=ac.disabled=!(ae.value&&am.value&&(m(W)||3<ab.filter(m).length));if(ad.disabled){if(this.hasOwnProperty("map")){ai.slice(ai.indexOf(ag)+1).forEach(E.disable)}}else{ad.emit("click")}}.bind(this),ah;Y.innerHTML=140;am.value=ae.value=V.innerHTML=Z.innerHTML="";V.on("change",this.onActivityChange||(this.onActivityChange=function(){ak.currentActivity=this.value;af.currentTarget.trigger(af)}));am.on("keyup",this.onNameChange||(this.onNameChange=function(ao){var ap=am.value.trim(),an=V.options[V.selectedIndex];g(ak).name=ap;if(ap){an.value=ak.currentActivity;an.innerHTML="";an.append(ap)}aa()}));ae.on("keyup",this.onDescriptionChange||(this.onDescriptionChange=function(ar){var ap=ae.value.trim(),ao=parseInt(ae.getAttribute("maxlength"),10),aq=(ao-ap.length),an;if(aq<0){aq=0;ae.value=ap.slice(0,ao)}Y.innerHTML=aq;an=g(ak).description;if(!(al.value in an)){U(al.value)}an[al.value]=ap;if(!ap.length){delete an[al.value];Z.innerHTML="";Object.keys(an).forEach(U)}aa()}));al.on("change",this.onLanguageDescriptionChange||(this.onLanguageDescriptionChange=function(ao){var an=g(ak).description;ae.value=an[al.value]||"";ae.emit("keyup")}));ak.activities.forEach(function(aq,ao){if(/^remove:/.test(aq.id)){return}var ap=V.appendChild(document.createElement("option")),an;ap.value=aq.id;ap.append(aq.name);if(!ak.hasOwnProperty("currentActivity")||aq.id==ak.currentActivity){ak.currentActivity=aq.id;ap.selected="selected";am.value=aq.name;an=Object.keys(aq.description);an.forEach.call(al.options,l,an[0]);an.forEach(U);ae.value=aq.description[al.value]||"";ae.emit("keyup")}},this);ac.on("click",this.onAnotherActivity||(this.onAnotherActivity=function(ap){var an=V.options,aq;ak.currentActivity=null;V.appendChild(document.createElement("option")).append(aq=am.placeholder||am.getAttribute("placeholder"));am.value=ae.value="";ae.emit("keyup");try{am.focus()}catch(ao){}ab.concat(X,W).forEach(function(ar){ar.checked=false});V.selectedIndex=an.length-1}));aj.on("click",this.onRemoveActivity||(this.onRemoveActivity=function(an){ak.currentActivity=null;P(ak.activities,V)}));ab.on("change",this.onCriteriaChange||(this.onCriteriaChange=function(){ab.forEach(N,g(ak).criteria=[]);aa()}));ah=ak.currentActivity?g(ak):{criteria:[],certification:[]};ab.forEach(function(an){an.checked=-1<this.criteria.indexOf(an.value);an.parentNode.on("click",J)},ah);X.checked=0<ah.criteria.length;W.checked=0<ah.certification.length;X.on("change",this.enableAddRemoveButtons||(this.enableAddRemoveButtons=function(){if(X.checked){g(ak).certification=[]}aa()}));W.on("change",this.onCertifiedEnabled||(this.onCertifiedEnabled=function(){if(W.checked){g(ak).certification=[1]}aa()}));ad.on("click",this.onNextActivity||(this.onNextActivity=function(an){g(ak).currentPlace=null;this.trigger("step-4",ak)}.bind(this)));aa();if(ac.disabled&&aj.disabled){ac.emit("click")}},"step-4":function(ah){var am=ah.detail,V=g(am),W=V.currentPlace||!V.place.length?S(V):V.place[0],ai=$("fieldset#"+ah.type)[0],ag=$("i",ai)[0],X=$("select[name=place]",ai)[0],Z=$("button[name=add]",ai)[0],al=$("button[name=remove]",ai)[0],ac=$("button.next",ai)[0],ad=$("select[name=category]",ai)[0],U=$("div.map > button",ai)[0],ab=$("div.fields > input",ai),ak=[ab[0],ab[2],ab[3],ab[4],ab[5],ab[6]],Y=[ab[0],ab[2]],aa=function(){ac.disabled=Z.disabled=(W.latitude==null&&ag.value!="question");al.disabled=X.options.length<2};q.className=i.no;V.currentPlace=W.id;this.hasExplicitPlace=false;$("fieldset",ai).forEach(E.enable);if(!this.hasOwnProperty("map")){L.tileLayer("http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg",{attribution:"Map Tiles &copy; Open MapQuest",maxZoom:18}).addTo(this.map=L.map("map"));this.setMapView=function af(ao,an){this.map.setView([ao.latitude||ao.lat,ao.longitude||ao.lng],an||Math.max(14,this.map.getZoom()))};this.setPlaceView=function aj(an){this.dropMarker();this.marker=L.marker([an.latitude||an.lat,an.longitude||an.lng],{icon:L.icon({iconUrl:f(ad.value,36),iconSize:[36,36]})}).addTo(this.map);this.setMapView(an);aa()};this.dropMarker=function(){if(this.marker){this.map.removeLayer(this.marker);this.marker=null}};this.setMapView(navigator.country.geo,5);X.on("change",function(){g(am).currentPlace=this.value;ah.currentTarget.trigger(ah)});Z.on("click",function(){var aq=g(am),ao=X.options,an=(aq.currentPlace=null)||S(aq),ap=X.appendChild(document.createElement("option"));ap.append(" - ");ap.value=an.id;X.selectedIndex=ao.length-1;X.emit("change")});al.on("click",function(){var an=g(am);an.currentPlace=null;P(an.place,X)});ad.on("change",this.onCategoryChange||(this.onCategoryChange=function(an){ag.className="icon-"+ad.value;S(g(am)).icon=ad.value;if(this.marker){this.setPlaceView(this.marker.getLatLng())}}.bind(this)));ac.on("click",this.boundTo(function(){var an=D(am);if(an===true){this.trigger("step-5",am)}else{w(an)}}));ak.on("keyup",function(an){if(!this.hasExplicitPlace){clearTimeout(this.findPlaceTimer||0);q.className=i.searching;this.findPlaceTimer=setTimeout(this.boundTo(s),1000,ak)}}.bind(this));this.on("search:place",function(an){if(!this.hasExplicitPlace){this.setPlaceView(H(S(g(am)),ab,an.detail))}});$("#map").on("contextmenu",function ae(an){an.preventDefault();an.stopPropagation();if(this.hasExplicitPlace){R.address="";q.className=i.no;this.hasExplicitPlace=false;this.dropMarker()}else{if(this.askedUserIfPutAPlaceOnMap||confirm("would like to pin it here ?")){this.hasExplicitPlace=this.askedUserIfPutAPlaceOnMap=true;an=this.map.containerPointToLatLng(this.map.mouseEventToContainerPoint(an));if(!(isNaN(an.lat)||isNaN(an.lng))){this.setPlaceView(H(S(g(am)),ab,{latitude:an.lat,longitude:an.lng}));q.className=i.ok}}}}.bind(this));U.on("click",function(){U.disabled=true;try{navigator.geolocation.getCurrentPosition(function ap(aq){this.setView([aq.coords.latitude,aq.coords.longitude],Math.max(14,this.getZoom()));U.disabled=false}.bind(this),function an(){U.disabled=false},{maximumAge:600000})}catch(ao){}}.bind(this.map));Y.on("keyup",function(){var an=X.options[X.selectedIndex];an.innerHTML="";an.append(Y.map(k).join(" - "))})}this.dropMarker();while(X.options.length){X.options[0].remove()}V.place.forEach(function(an,ao){if(/^remove:/.test(an.id)){return}var ap=X.appendChild(document.createElement("option"));ap.value=an.id;ap.append(an.road+" - "+an.postcode);if(an.id==V.currentPlace){ap.selected="selected";X.selectedIndex=ao}});ab.forEach(function(an){var ao=W&&W[an.name]||"";if(ao.length&&an.name==="twitter"){ao="@"+ao}an.value=ao});ab.on("keyup",p);p.target=W;v(ad,W.icon||ad.options[0].value,ag);aa();if(W.latitude!=null){this.setPlaceView(W)}},"step-5":function(Y){var U=Y.detail,X=$("fieldset#"+Y.type)[0],V=$("div",X)[0],Z=$("input[type=checkbox]",X)[0],W=$("input[type=submit]",X)[0];W.disabled=true;Z.on("change",this.onAgreement||(this.onAgreement=function(){W.disabled=!this.checked}));W.on("click",this.onSaveAllTheData||(this.onSaveAllTheData=function(){var aa=D(U),ac,ab;if(aa===true){W.disabled=true;ac=JSON.parse(JSON.stringify(U));delete ac.currentActivity;ac.activities.forEach(B);console.log(JSON.stringify(ac));console.log(ac);ab=new XMLHttpRequest;ab.open("POST","cgi/create.php",true);ab.setRequestHeader("If-Modified-Since","Mon, 26 Jul 1997 05:00:00 GMT");ab.setRequestHeader("Cache-Control","no-cache");ab.setRequestHeader("X-Requested-With","XMLHttpRequest");ab.setRequestHeader("Content-Type","application/x-www-form-urlencoded");ab.on("readystatechange",function(){if(ab.readyState==4){$("fieldset").forEach(E.enable);switch(ab.responseText){case"OK":alert(")°(,");return location.reload();break;case"bad-data":alert("bad data");break;default:alert(ab.responseText||"connection error");break}W.disabled=false}});ab.send("info="+encodeURIComponent(JSON.stringify(ac)))}else{w(aa)}}))}},I=["mousedown","mousemove","mouseup","click"],E={disable:function(U){U.classList.add("disabled");I.forEach(E._addStopEvent,U)},enable:function(U){U.classList.remove("disabled");I.forEach(E._removeStopEvent,U)},_addStopEvent:function(U){this.on(U,t,true)},_removeStopEvent:function(U){this.off(U,t,true)}};function t(U){U.preventDefault();(U.stopImmediatePropagation||U.stopPropagation).call(U)}function F(U){U.place=c.unpack(U.place)}function o(U,V){var X=V.value.trim(),W=V.data("email"),Y;if(n.test(X)&&X!==W){V.data("email",X);U.xhr=Y=new XMLHttpRequest;Y.target=U;Y.open("get","cgi/verify.php?email="+encodeURIComponent(X),true);Y.on("readystatechange",u).send(null);C.email=X}}function O(V){var U=V.detail;C.currentActivity=null;switch(typeof U){case"object":C.activities=U;if(C.activities.length){C.activities.forEach(F);C.currentActivity=C.activities[0].id}break;case"boolean":if(confirm(jslang.seeYouLater)){}return location.href="http://equolo.org/";default:C.activities=[]}if(C.hasOwnProperty("activities")){this.trigger("step-3",C)}}function Q(W){var U=W.currentTarget;C.email=null;try{this.xhr.abort()}catch(V){}clearTimeout(parseInt(U.data("timer")||0,10));if(n.test(U.value.trim())){U.data("timer",setTimeout(o,1000,this,U))}else{while(U=U.parentNode){if(U.nodeName==="FIELDSET"){$("fieldset").slice($("fieldset").indexOf(U)+1).forEach(E.disable);break}}}}function u(){if(this.readyState===4){this.target.trigger("email:verified",JSON.parse(this.responseText))}}function h(X,Y){for(var V=0,W=X.length,U;V<W;V++){U=X[V];if(U.id==Y){return U}}}function G(X,W){for(var U=X.options,V=0;V<U.length;V++){if(U[V].value==W){return U[V].innerHTML}}}function g(U){if(!U.currentActivity){U.activities.push({id:(U.currentActivity="new:".concat(++j)),name:"",description:{},criteria:[],certification:[],place:[]})}return h(U.activities,U.currentActivity)}function m(U){return U.checked}function J(U){if(U.target==this){this.firstChild.checked=!this.firstChild.checked;this.firstChild.emit("change")}}function P(W,U){var V=h(W,U.value);if(/^new:/.test(V.id)){W.splice(W.indexOf(V),1)}else{if(!/^remove:/.test(V.id)){V.id="remove:"+V.id}}U.options[U.selectedIndex--].remove();U.emit("change")}function l(U){U.selected=U.value==this?"selected":""}function N(U){if(U.checked){this.push(U.value)}}function v(U,Y,X){for(var V=U.options,W=V.length;W--;){if(V[W].value==Y){U.selectedIndex=W;V[W].selected=true;X.className="icon-"+Y}else{V[W].selected=false}}}function y(U){if(U&&U.length){q.className=i.ok;this.trigger("search:place",{latitude:U[0].lat,longitude:U[0].lon})}else{if(/^[0-9][\w-]*|[0-9][\w-]*$/.test(R.fields[0])){R.fields[0]=R.fields[0].replace(RegExp.lastMatch,"").replace(/[,;]/,"").trim();R.call(this,R.fields)}else{q.className=i.error}}}function R(U,X){var V=U.join(", "),W,Y;if(R.address!=V){R.address=V;R.fields=U;Y=K++;while(Y--){d[r+Y]=Object}d[r+K]=this.boundTo(y);W=document.body.appendChild(document.createElement("script"));W.on("load",W.remove).on("error",W.remove);W.type="text/javascript";W.src="http://nominatim.openstreetmap.org/search?format=json&json_callback="+r+K+"&q="+encodeURIComponent(V)}else{q.className=this.marker?i.ok:i.error}}function s(U){var V=U.map(k).filter(T);if(3<V.length){R.call(this,V)}}function S(U){if(!U.currentPlace){U.place.push({id:(U.currentPlace="new:".concat(++j)),icon:"",latitude:null,longitude:null,road:"",extra:"",postcode:"",city:"",county:"",state:"",country:"",email:"",phone:"",website:"",twitter:"",facebook:""})}return h(U.place,U.currentPlace)}function T(U){return 0<U.length}function k(U){return U.value.trim()}function w(U){alert(["uhm, something does not seem right","----------------------------------",U.join("\n"),"----------------------------------","it looks like something is wrong with the data","please verify the following:","  1. every activity has at least one place","  2. there are no places without a location","  3. every place has at least 4 address fields","  4. every place has a specific icon"].join("\n"))}function p(V){var U=V.currentTarget;p.target[U.name]=U.value}function H(V,U,X){var W=U.length;V.latitude=U[W-2].value=X.latitude;V.longitude=U[W-1].value=X.longitude;return V}function D(V){var U=[];if(!n.test(V.email)){return U.push("wrong email address")&&U}return V.activities.every(z,U)||U.reverse()}function z(W,V,U){return(W.name.trim().length&&(U=Object.keys(W.description))&&U.length&&W.description[U[0]].trim().length&&(W.certification.length||3<W.criteria.length)&&((!W.place.length&&/^remove:/.test(W.id))||(W.place.length&&W.place.every(M,this)))&&!!W.id)||!this.push("[activity] "+(W.name||"?"))}function M(U){return(x.test(U.latitude)&&x.test(U.longitude)&&U.road.trim().length&&2<(U.postcode.trim().length+U.city.trim().length+U.county.trim().length+U.state.trim().length+U.country.trim().length)&&U.icon&&U.icon!="question"&&!!U.id)||!this.push("  "+(U.road||"?")+" - "+(U.postcode||"?"))}function B(U){U.place=c.pack(U.place);delete U.currentPlace}Object.keys(A).forEach(function(U){if(U!=="handleEvent"){this.on(U,this)}},A);$("fieldset").forEach(E.disable);A.trigger("step-1")})}(this));