/*! )°(, equolo - https://github.com/equolo/equolo.org */
/*@cc_on
(function(f){
window.setTimeout=f(window.setTimeout);
window.setInterval=f(window.setInterval);
})(function(f){return function(c,t,a){a=[].slice.call(arguments,2);return f(function(){c.apply(this,a)},t)}});
@*/
var
IEMobile=/*@cc_on/\bIEMobile\b/.test(navigator.userAgent)||@*/false,
IE9Mobile=/*@cc_on(IEMobile&&@_jscript_version<10)||@*/false,
IE10Mobile=/*@cc_on(IEMobile&&@_jscript_version/10>=1)||@*/false
;
IE9Mobile&&document.write('<link rel="stylesheet" href="css/IE9Mobile.css"/><script src="js/IE9Mobile.js"></script>');(function(d){
/*! display v0.1.3 - MIT license */
;var e=function(s){var j=s.Math,n=j.abs,u=j.max,r=j.min,y=s.Infinity,h=s.screen||y,g=d.matchMedia,o="addEventListener",x=s.document.documentElement,k=/\bMobile\b/.test(navigator.userAgent),p={change:[]},t={width:0,height:0,ratio:0,on:function(z,A){p[z].push(A)}},v=p.change.forEach||function(B,z){for(var A=0;A<this.length;A++){B.call(z,this[A],A,this)}},l;function m(z){z.call(t,t.width,t.height)}function q(z){if(l){clearTimeout(l)}l=setTimeout(i,300,z)}function i(F){l=0;var A=s.devicePixelRatio||1,E="orientation" in this,G=E?n(this.orientation||0)===90:!!g&&g("(orientation:landscape)").matches,B=h.width,D=h.height,C=r(s.innerWidth||x.clientWidth,A<1?y:((k&&G?u(B,D):B)||y)),z=r(s.innerHeight||x.clientHeight,A<1?y:((k&&G?r(B,D):D)||y));if(C!==t.width||z!==t.height){t.width=C;t.height=z;v.call(p.change,m)}}if(o in s){s[o]("orientationchange",q,true);s[o]("resize",q,true);try{h[o]("orientationchange",q,true)}catch(w){}}else{s.attachEvent("onresize",i)}i.call(s);t.ratio=s.devicePixelRatio||h.width/t.width||(h.deviceXDPI||1)/(h.logicalXDPI||1);return t}(d);(function(i,g,h){"indexOf" in i||(i.indexOf=function(j){for(var k=this.length;k--&&this[k]!==j;){}return k});"bind" in g||(g.bind=function(m){var l=this,k=i.slice,j=k.call(arguments,1);return function(){return l.apply(m,j.concat(k.call(arguments)))}});"trim" in h||(h.trim=function(){return this.replace(/^[^\S]+|[^\S]+$/g,"")})}(Array.prototype,Function.prototype,String.prototype));var c,b=c=function(p,i){function x(F){for(var A=F.length,G=n(A?F[0]:{}),B=G.length,H=p(A*B),E=0,D=0,C,z;E<A;++E){for(z=F[E],C=0;C<B;H[D++]=z[G[C++]]){}}return k.call([B],G,H)}function v(D){for(var E=D.length,A=D[0],z=p(((E-A-1)/A)||0),C=1+A,B=0,G,F;C<E;){for(z[B++]=(F={}),G=0;G<A;F[D[++G]]=D[C++]){}}return z}function j(A){return function z(G){for(var I=this,H=G,E=0,F=I.length,C,B,D;E<F;++E){if(m(D=H[B=I[E]])){C=E+1;H[B]=C<F?y.call(D,A,I.slice(C)):A(D)}H=H[B]}return G}}function l(A){return function z(H,F){for(var C=m(H),B=k.call(h,H),G=k.call(h,F),D=0,E=G.length;D<E;++D){B=y.call(B,A,G[D].split("."))}return C?B:B[0]}}function t(A,z){return z?o(A,z):x(A)}function g(z,A){return A?s(z,A):v(z)}function r(C,z,B,A){return w(t(C,A),z,B)}function q(A,z,B){return g(u(A,z),B)}var h=[],k=h.concat,n=Object.keys||function(B){var A=[],z;for(z in B){B.hasOwnProperty(z)&&A.push(z)}return A},m=p.isArray||(function(A,B){B=A.call(h);return function z(C){return A.call(C)==B}}({}.toString)),y=h.map||function(D,C){for(var A=this,B=A.length,z=p(B);B--;z[B]=D.call(C,A[B],B,A)){}return z},o=l(j(x)),s=l(j(v)),w=i.stringify,u=i.parse;return{pack:t,parse:q,stringify:r,unpack:g}}(Array,JSON);
/*! (C) WebReflection Mit Style License */
(function(z){function F(h){return typeof h=="string"?z.document.createTextNode(h):h}function m(p){if(p.length===1){return F(p[0])}for(var o=z.document.createDocumentFragment(),h=x.call(p),l=0;l<p.length;l++){o.appendChild(F(h[l]))}return o}for(var g,w,G,k=/^\s+|\s+$/g,E=/\s+/,C=" ",y=function(h,i){return this.contains(h)?i||this.remove(h):i&&this.add(h),!!i},q=(z.Element||z.Node||z.HTMLElement).prototype,B=["prepend",function(){var h=this.firstChild,i=m(arguments);h?this.insertBefore(i,h):this.appendChild(i)},"append",function(){this.appendChild(m(arguments))},"before",function(){var h=this.parentNode;h&&h.insertBefore(m(arguments),this)},"after",function(){var l=this.parentNode,n=this.nextSibling,h=m(arguments);l&&(n?l.insertBefore(h,n):l.appendChild(h))},"replace",function(){var h=this.parentNode;h&&h.replaceChild(m(arguments),this)},"remove",function(){var h=this.parentNode;h&&h.removeChild(this)}],x=B.slice,j=B.length;j;j-=2){g=B[j-2],g in q||(q[g]=B[j-1])}"classList" in document.documentElement?(G=document.createElement("div").classList,G.add("a","b"),"a b"!=G&&(q=G.constructor.prototype,"add" in q||(q=z.DOMTokenList.prototype),w=function(h){return function(){var i=0;while(i<arguments.length){h.call(this,arguments[i++])}}},q.add=w(q.add),q.remove=w(q.remove),q.toggle=y)):(w=function(h){if(!h){throw"SyntaxError"}if(E.test(h)){throw"InvalidCharacterError"}return h},G=function(i){var h=i.className.replace(k,"");h.length&&B.push.apply(this,h.split(E)),this._=i},G.prototype={length:0,add:function(){for(var h=0,i;h<arguments.length;h++){i=arguments[h],this.contains(i)||B.push.call(this,g)}this._.className=""+this},contains:function(h){return function(i){return j=h.call(this,g=w(i)),-1<j}}([].indexOf||function(h){j=this.length;while(j--&&this[j]!==h){}return j}),item:function(h){return this[h]||null},remove:function(){for(var h=0,i;h<arguments.length;h++){i=arguments[h],this.contains(i)&&B.splice.call(this,j,1)}this._.className=""+this},toggle:y,toString:function D(){return B.join.call(this,C)}},(Object.defineProperty||function(i,h,l){i.__defineGetter__(h,l.get)})(q,"classList",{get:function(){return new G(this)},set:function(){}}));try{new z.CustomEvent("?")}catch(A){z.CustomEvent=function(l,h){function o(t,p){var r=document.createEvent(l);if(typeof t!="string"){throw new Error("An event name must be provided")}return l=="Event"&&(r.initCustomEvent=i),p==null&&(p=h),r.initCustomEvent(t,p.bubbles,p.cancelable,p.detail),r}function i(u,p,v,s){this.initEvent(u,p,v),this.detail=s}return o}(z.CustomEvent?"CustomEvent":"Event",{bubbles:!1,cancelable:!1,detail:null})}})(d);
/*! (C) Andrea Giammarchi Mit Style License */
(function(aa){function H(){return{l:{},m:[],b:[]}}function q(h){var g=H();return ac.value=g,O(h,Z,ac),ac.value=null,g}function B(h,g,i){typeof g=="function"?g.apply(h,i):g.handleEvent.apply(g,i)}function j(h,g,i){i&&A(this,"detail",i),A(this,"type",g),A(this,"target",h),A(this,"timeStamp",R())}if(aa.eddy){return}aa.eddy=!0;var I=Array.prototype,Q=aa.prototype,M=j.prototype,W=Q.hasOwnProperty,J=I.push,P=I.slice,G=I.unshift,ae="toLocaleString",Z={toLocaleString:1}.propertyIsEnumerable(ae)?"_@eddy"+Math.random():ae,U=Z===ae,ac=(aa.create||aa)(null),X=[],O=U?function(h,g,i){h[g]=i.value}:aa.defineProperty,ab=function(h){var g=this;return function(){return g.apply(h,arguments)}},F=I.indexOf||function(h){var g=this.length;while(g--&&this[g]!==h){}return g},R=Date.now||function(){return(new Date).getTime()},Y={boundTo:function(i){var m=W.call(this,Z)?this[Z]:q(this),k=m.m,l=m.b,h=typeof i=="string"?this[i]:i,g=F.call(k,h);return g<0?l[J.call(k,h)-1]=ab.call(h,this):l[g]},emit:function(k){var v=W.call(this,Z),o=v&&this[Z].l,m=v&&W.call(o,k),i=m&&o[k],h=m&&P.call(arguments,1),g=0,p=m?i.length:g;while(g<p){B(this,i[g++],h)}return m},listeners:function(g){return W.call(this,Z)&&W.call(this[Z].l,g)&&this[Z].l[g].slice()||[]},off:function(h,m){var k=W.call(this,Z),i=k&&this[Z].l,l=k&&W.call(i,h)&&i[h],g;return l&&(g=F.call(l,m),-1<g&&(l.splice(g,1),l.length||delete i[h])),this},on:function(i,p,k){var m=W.call(this,Z),h=(m?this[Z]:q(this)).l,g=m&&W.call(h,i)?h[i]:h[i]=[];return F.call(g,p)<0&&(k?G:J).call(g,p),this},once:function(h,m,l){var g=function(i){k.off(h,g,l),B(k,m,arguments)},k=this;return k.on(h,g,l)},trigger:function(N,i){var S=W.call(this,Z),h=S&&this[Z].l,E=typeof N=="string",y=E?N:N.type,r=S&&W.call(h,y),x=r&&h[y].slice(0),g=E?new j(this,y,i):N,w=0,C=r?x.length:w,k=!(g instanceof j);k&&(g._active=!0,g.stopImmediatePropagation=M.stopImmediatePropagation),g.currentTarget=this,X[0]=g;while(g._active&&w<C){B(this,x[w++],X)}return k&&(delete g._active,delete g.stopImmediatePropagation),!g.defaultPrevented}},A=function(h,g,i){W.call(h,g)||(h[g]=i)},ad=!1,D;M.defaultPrevented=!1,M._active=M.cancelable=!0,M.preventDefault=function(){this.defaultPrevented=!0},M.stopImmediatePropagation=function(){this._active=!1};for(D in Y){W.call(Y,D)&&O(Q,D,{enumerable:!1,configurable:!0,writable:!0,value:Y[D]})}(function(h){function i(k){function l(m){m[k].apply(m,this)}return function(){return h.call(this,l,arguments),this}}for(var g in Y){Y.hasOwnProperty(g)&&!/^listeners|boundTo$/.test(g)&&O(I,g,{enumerable:!1,configurable:!0,writable:!0,value:i(g)})}})(I.forEach);var z={boundTo:Y.boundTo,data:function V(h,g){var i="dataset" in this;return arguments.length<2?i?this.dataset[h]:(g=this.getAttribute("data-"+h.replace(V.gre||(V.gre=/-[a-z]/g),V.gplace||(V.gplace=function(l,k){return k.toUpperCase()}))))==null?void 0:g:i?g==null?delete this.dataset[h]:(this.dataset[h]=g,g):(V.sre||(V.sre=/([a-z])([A-Z])/g,V.splace=function(l,k,m){return k+"-"+m.toLowerCase()}),h="data-"+h.replace(V.sre,V.splace),g==null?!this.removeAttribute(h):(this.setAttribute(h,g),g))},emit:function(h){var g=new CustomEvent(h);return g.arguments=I.slice.call(arguments,1),this.dispatchEvent(g)},listeners:function(g){return[]},off:function(h,g,i){return this.removeEventListener(h,g,i),this},on:function(h,g,i){return this.addEventListener(h,g,i),this},once:Y.once,trigger:function(h,m){var l=typeof h=="string",g=l?h:h.type,k=l?new CustomEvent(g,(ac.detail=m,ac)):h;return ac.detail=null,j.call(k,this,g),this.dispatchEvent(k)}};ac.cancelable=!0,ac.bubbles=!0;try{document.createEvent("Event").target=document}catch(K){ad=!0,A=function(i,g,k){if(!W.call(i,g)){try{i[g]=k}catch(h){}}}}(function(m){var i=m.Window,v=i?i.prototype:m,l=(m.Node||m.Element||m.HTMLElement).prototype,k=(m.Document||m.HTMLDocument).prototype,p=(m.XMLHttpRequest||function(){}).prototype,h,g;for(h in z){W.call(z,h)&&(g={enumerable:!1,configurable:!0,writable:!0,value:z[h]},O(v,h,g),O(l,h,g),O(k,h,g),h!=="data"&&O(p,h,g))}})(d)})(Object);d.$=function(g){return function(i,h){return g.slice.call(g.concat(h||document)[0].querySelectorAll(i))}}([]);
/*! SimpleKinetic v0.1.1 - MIT license */
;var a=function(h){var p=h.isNaN,i=h.Math,w=i.abs,v=i.round,s=i.sqrt,o=h.setInterval,t=h.clearInterval,k=0.2,u=9,q=1000/60,n=j.prototype;function j(x){for(var y in x){if(/^on|context|interval/.test(y)){this[y]=x[y]}}}n.init=function(O,N,E,C,H,F){var P=m(this),D=(w(E)<1?0:E)*(H?1:u),J=(w(C)<1?0:C)*(F?1:u),B=D*D,I=J*J,A=s(B+I),z=D/A,G=J/A,M,K;P.cancel(P._cx,P._cy);if(!(p(z)||p(G))){P._a=o(l,P.interval||q,P);P._t=0;P._d=A;P._sx=P._cx=O;P._sy=P._cy=N;P._xa=z;P._ya=G;M=v(O+A*z);K=v(N+A*G);P._ex=M;P._ey=K;if((O!==M||N!==K)&&P.start(O,N,0,0,M,K)!==false){return true}m(P._a)}return false};n.start=r("start");n.move=r("move");n.end=r("end");n.cancel=function(z,x,A,y,C,B){if(this._a){m(this).oncancel.call(this.context||this,z,x,A,y,C,B)}};n.onstart=n.onmove=n.onend=n.oncancel=function(z,x,A,y,C,B){};function m(x){t(x._a);x._a=0;return x}function r(x){x="on"+x;return function(A,y,B,z,D,C){return this[x].call(this.context||this,A,y,B,z,D,C)}}function l(A){var F=(A._t+=(A._d-A._t)*k),z=v(A._sx+F*A._xa),G=v(A._sy+F*A._ya),E=A._ex,C=A._ey,D=z-A._cx,B=G-A._cy;if(z===E&&G===C){m(A).end(E,C,D,B,E,C)}else{A.move(z,G,D,B,E,C);A._cx=z;A._cy=G}}var g=o(function(x){t(g);if(!x){o=function(A,z,y){return h.setInterval(function(){A(y)},z)}}},0,1);return j}(this);var f=function(h){var i=h.getContext("2d"),l={question:61736,"shopping-cart":61562,gift:61547,food:61685,home:61461,glass:61440,briefcase:61617,group:61632,truck:61649,"map-marker":32},g={};function k(o,q,p){i.beginPath();i.arc(o,q,p,0,Math.PI*2,true);i.closePath();i.fill()}function j(p,o){i.clearRect(0,0,h.width,h.height);h.width=h.height=o;i.textBaseline="bottom";i.fillStyle="rgb(25,138,138)";k(o/2,o/2.5,o/2.5);m(o,o/4.9);i.fillStyle="rgb(240,240,240)";k(o/2,o/2.5,o/2.8);i.font=i.mozTextStyle=Math.round(o/2)+"px FontAwesome";i.translate((h.width-(i.measureText||i.mozMeasureText).call(i,p).width)/2,0);i.fillStyle="rgb(40,104,104)";i.fillText(p,0,o/1.5);return h.toDataURL()}function m(o,p){i.beginPath();i.moveTo(o/2,o);i.lineTo(p,o/1.5);i.lineTo(o-p,o/1.5);i.lineTo(o/2,o);i.closePath();i.fill()}return function n(q,o,p){return g[q+o+p]||(g[q+o+p]=j(String.fromCharCode(l[q]),Math.round(o*(p||(typeof e==="undefined"?1:e.ratio)))))}}(document.createElement("canvas"));document.once("DOMContentLoaded",function(){var n=/^[^@]+?@[^\1@]+\.([a-z]{2,})$/,x=/^-?\d+(?:\.\d+)?$/,j=0,J=0,r="_JSONP",q=$("fieldset#step-4 fieldset.address > legend > i")[0],i={no:"icon-angle-down",ok:"icon-ok",error:"icon-exclamation-sign",searching:"icon-refresh icon-spin"},C={},A={handleEvent:function(V){var U=V.type,T;if("_type" in this){T=this._type+"-terminate";if(T in this){this[T](V)}}this._type=U;T=U+"-init";if(T in this){this[T](V)}D.enable($("fieldset#"+U)[0]);this[U](V)},"step-1":function(V){var U=$("fieldset#"+V.type)[0],T=$("select",U);T.once("change",function(){location.href=location.href.split(/[\?#]/)[0]+"?lang="+this.value});this.trigger("step-2")},"step-2":function(V){var U=$("fieldset#"+V.type)[0],T=$("input",U)[0];this.on("email:verified",N);T.on("keyup",this.boundTo(P));T.emit("keyup")},"step-3":function(ae){var aj=ae.detail,ah=$("fieldset"),af=$("fieldset#"+ae.type)[0],U=$("select[name=activity]",af)[0],ab=$("button[name=add]",af)[0],ai=$("button[name=remove]",af)[0],ac=$("button.next",af)[0],al=$("input[name=name]",af)[0],ad=$("textarea[name=description]",af)[0],ak=$("select[name=lang]",af)[0],X=$("div.lang > p > span",af)[0],Y=$("ul",af)[0],aa=$("div.criteria input",af),V=aa.shift(),W=aa.shift(),T=function(an){var am=Y.appendChild(document.createElement("li")),ao=am.appendChild(document.createElement("strong"));ao.append("√");am.append(ao);am.append(" "+F(ak,an))},Z=function(){ai.disabled=!U.options.length;ac.disabled=ab.disabled=!(ad.value&&al.value&&(m(V)||3<aa.filter(m).length));if(ac.disabled){if(this.hasOwnProperty("map")){ah.slice(ah.indexOf(af)+1).forEach(D.disable)}}else{ac.emit("click")}}.bind(this),ag;X.innerHTML=140;al.value=ad.value=U.innerHTML=Y.innerHTML="";U.on("change",this.onActivityChange||(this.onActivityChange=function(){aj.currentActivity=this.value;ae.currentTarget.trigger(ae)}));al.on("keyup",this.onNameChange||(this.onNameChange=function(an){var ao=al.value.trim(),am=U.options[U.selectedIndex];g(aj).name=ao;if(ao){am.value=aj.currentActivity;am.innerHTML="";am.append(ao)}Z()}));ad.on("keyup",this.onDescriptionChange||(this.onDescriptionChange=function(aq){var ao=ad.value.trim(),an=parseInt(ad.getAttribute("maxlength"),10),ap=(an-ao.length),am;if(ap<0){ap=0;ad.value=ao.slice(0,an)}X.innerHTML=ap;am=g(aj).description;if(!(ak.value in am)){T(ak.value)}am[ak.value]=ao;if(!ao.length){delete am[ak.value];Y.innerHTML="";Object.keys(am).forEach(T)}Z()}));ak.on("change",this.onLanguageDescriptionChange||(this.onLanguageDescriptionChange=function(an){var am=g(aj).description;ad.value=am[ak.value]||"";ad.emit("keyup")}));aj.activities.forEach(function(ap,an){if(/^remove:/.test(ap.id)){return}var ao=U.appendChild(document.createElement("option")),am;ao.value=ap.id;ao.append(ap.name);if(!aj.hasOwnProperty("currentActivity")||ap.id==aj.currentActivity){aj.currentActivity=ap.id;ao.selected="selected";al.value=ap.name;am=Object.keys(ap.description);am.forEach.call(ak.options,l,am[0]);am.forEach(T);ad.value=ap.description[ak.value]||"";ad.emit("keyup")}},this);ab.on("click",this.onAnotherActivity||(this.onAnotherActivity=function(ao){var am=U.options,ap;aj.currentActivity=null;U.appendChild(document.createElement("option")).append(ap=al.placeholder||al.getAttribute("placeholder"));al.value=ad.value="";ad.emit("keyup");try{al.focus()}catch(an){}aa.concat(W,V).forEach(function(aq){aq.checked=false});U.selectedIndex=am.length-1}));ai.on("click",this.onRemoveActivity||(this.onRemoveActivity=function(am){aj.currentActivity=null;O(aj.activities,U)}));aa.on("change",this.onCriteriaChange||(this.onCriteriaChange=function(){aa.forEach(M,g(aj).criteria=[]);Z()}));ag=aj.currentActivity?g(aj):{criteria:[],certification:[]};aa.forEach(function(am){am.checked=-1<this.criteria.indexOf(am.value);am.parentNode.on("click",I)},ag);W.checked=0<ag.criteria.length;V.checked=0<ag.certification.length;W.on("change",this.enableAddRemoveButtons||(this.enableAddRemoveButtons=function(){if(W.checked){g(aj).certification=[]}Z()}));V.on("change",this.onCertifiedEnabled||(this.onCertifiedEnabled=function(){if(V.checked){g(aj).certification=[1]}Z()}));ac.on("click",this.onNextActivity||(this.onNextActivity=function(am){g(aj).currentPlace=null;this.trigger("step-4",aj)}.bind(this)));Z();if(ab.disabled&&ai.disabled){ab.emit("click")}},"step-4":function(ag){var al=ag.detail,U=g(al),V=U.currentPlace||!U.place.length?R(U):U.place[0],ah=$("fieldset#"+ag.type)[0],af=$("i",ah)[0],W=$("select[name=place]",ah)[0],Y=$("button[name=add]",ah)[0],ak=$("button[name=remove]",ah)[0],ab=$("button.next",ah)[0],ac=$("select[name=category]",ah)[0],T=$("div.map > button",ah)[0],aa=$("div.fields > input",ah),aj=[aa[0],aa[2],aa[3],aa[4],aa[5],aa[6]],X=[aa[0],aa[2]],Z=function(){ab.disabled=Y.disabled=(V.latitude==null&&af.value!="question");ak.disabled=W.options.length<2};q.className=i.no;U.currentPlace=V.id;this.hasExplicitPlace=false;$("fieldset",ah).forEach(D.enable);if(!this.hasOwnProperty("map")){L.tileLayer("http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg",{attribution:"Map Tiles &copy; Open MapQuest",maxZoom:18}).addTo(this.map=L.map("map"));this.setMapView=function ae(an,am){this.map.setView([an.latitude||an.lat,an.longitude||an.lng],am||Math.max(14,this.map.getZoom()))};this.setPlaceView=function ai(am){this.dropMarker();this.marker=L.marker([am.latitude||am.lat,am.longitude||am.lng],{icon:L.icon({iconUrl:f(ac.value,36),iconSize:[36,36]})}).addTo(this.map);this.setMapView(am);Z()};this.dropMarker=function(){if(this.marker){this.map.removeLayer(this.marker);this.marker=null}};this.setMapView(navigator.country.geo,5);W.on("change",function(){g(al).currentPlace=this.value;ag.currentTarget.trigger(ag)});Y.on("click",function(){var ap=g(al),an=W.options,am=(ap.currentPlace=null)||R(ap),ao=W.appendChild(document.createElement("option"));ao.append(" - ");ao.value=am.id;W.selectedIndex=an.length-1;W.emit("change")});ak.on("click",function(){var am=g(al);am.currentPlace=null;O(am.place,W)});ac.on("change",this.onCategoryChange||(this.onCategoryChange=function(am){af.className="icon-"+ac.value;R(g(al)).icon=ac.value;if(this.marker){this.setPlaceView(this.marker.getLatLng())}}.bind(this)));ab.on("click",this.boundTo(function(){var am=E(al);if(am===true){this.trigger("step-5",al)}else{w(am)}}));aj.on("keyup",function(am){if(!this.hasExplicitPlace){clearTimeout(this.findPlaceTimer||0);q.className=i.searching;this.findPlaceTimer=setTimeout(this.boundTo(s),1000,aj)}}.bind(this));this.on("search:place",function(am){if(!this.hasExplicitPlace){this.setPlaceView(G(R(g(al)),aa,am.detail))}});$("#map").on("contextmenu",function ad(am){am.preventDefault();am.stopPropagation();if(this.hasExplicitPlace){Q.address="";q.className=i.no;this.hasExplicitPlace=false;this.dropMarker()}else{if(this.askedUserIfPutAPlaceOnMap||confirm("would like to pin it here ?")){this.hasExplicitPlace=this.askedUserIfPutAPlaceOnMap=true;am=this.map.containerPointToLatLng(this.map.mouseEventToContainerPoint(am));if(!(isNaN(am.lat)||isNaN(am.lng))){this.setPlaceView(G(R(g(al)),aa,{latitude:am.lat,longitude:am.lng}));q.className=i.ok}}}}.bind(this));T.on("click",function(){T.disabled=true;try{navigator.geolocation.getCurrentPosition(function ao(ap){this.setView([ap.coords.latitude,ap.coords.longitude],Math.max(14,this.getZoom()));T.disabled=false}.bind(this),function am(){T.disabled=false},{maximumAge:600000})}catch(an){}}.bind(this.map));X.on("keyup",function(){var am=W.options[W.selectedIndex];am.innerHTML="";am.append(X.map(k).join(" - "))})}this.dropMarker();while(W.options.length){W.options[0].remove()}U.place.forEach(function(am,an){if(/^remove:/.test(am.id)){return}var ao=W.appendChild(document.createElement("option"));ao.value=am.id;ao.append(am.road+" - "+am.postcode);if(am.id==U.currentPlace){ao.selected="selected";W.selectedIndex=an}});aa.forEach(function(am){var an=V&&V[am.name]||"";if(an.length&&am.name==="twitter"){an="@"+an}am.value=an});aa.on("keyup",p);p.target=V;v(ac,V.icon||ac.options[0].value,af);Z();if(V.latitude!=null){this.setPlaceView(V)}},"step-5":function(X){var T=X.detail,W=$("fieldset#"+X.type)[0],U=$("div",W)[0],Y=$("input[type=checkbox]",W)[0],V=$("input[type=submit]",W)[0];V.disabled=true;Y.on("change",this.onAgreement||(this.onAgreement=function(){V.disabled=!this.checked}));V.on("click",this.onSaveAllTheData||(this.onSaveAllTheData=function(){var Z=E(T),ab,aa;if(Z===true){V.disabled=true;ab=JSON.parse(JSON.stringify(T));delete ab.currentActivity;ab.activities.forEach(B);console.log(JSON.stringify(ab));console.log(ab);aa=new XMLHttpRequest;aa.open("POST","cgi/create.php",true);aa.setRequestHeader("If-Modified-Since","Mon, 26 Jul 1997 05:00:00 GMT");aa.setRequestHeader("Cache-Control","no-cache");aa.setRequestHeader("X-Requested-With","XMLHttpRequest");aa.setRequestHeader("Content-Type","application/x-www-form-urlencoded");aa.on("readystatechange",function(){if(aa.readyState==4){$("fieldset").forEach(D.enable);switch(aa.responseText){case"OK":alert(")°(,");return location.reload();break;case"bad-data":alert("bad data");break;default:alert(aa.responseText||"connection error");break}V.disabled=false}});aa.send("info="+encodeURIComponent(JSON.stringify(ab)))}else{w(Z)}}))}},H=["mousedown","mousemove","mouseup","click"],D={disable:function(T){T.classList.add("disabled");H.forEach(D._addStopEvent,T)},enable:function(T){T.classList.remove("disabled");H.forEach(D._removeStopEvent,T)},_addStopEvent:function(T){this.on(T,t,true)},_removeStopEvent:function(T){this.off(T,t,true)}};function t(T){T.preventDefault();(T.stopImmediatePropagation||T.stopPropagation).call(T)}function o(T,U){var W=U.value.trim(),V=U.data("email"),X;if(n.test(W)&&W!==V){U.data("email",W);T.xhr=X=new XMLHttpRequest;X.target=T;X.open("get","cgi/verify.php?email="+encodeURIComponent(W),true);X.on("readystatechange",u).send(null);C.email=W}}function N(U){var T=U.detail;C.currentActivity=null;switch(typeof T){case"object":C.activities=T;if(C.activities.length){C.currentActivity=C.activities[0].id}break;case"boolean":if(confirm(jslang.seeYouLater)){}return location.href="http://equolo.org/";default:C.activities=[]}if(C.hasOwnProperty("activities")){this.trigger("step-3",C)}}function P(V){var T=V.currentTarget;C.email=null;try{this.xhr.abort()}catch(U){}clearTimeout(parseInt(T.data("timer")||0,10));if(n.test(T.value.trim())){T.data("timer",setTimeout(o,1000,this,T))}else{while(T=T.parentNode){if(T.nodeName==="FIELDSET"){$("fieldset").slice($("fieldset").indexOf(T)+1).forEach(D.disable);break}}}}function u(){if(this.readyState===4){this.target.trigger("email:verified",JSON.parse(this.responseText))}}function h(W,X){for(var U=0,V=W.length,T;U<V;U++){T=W[U];if(T.id==X){return T}}}function F(W,V){for(var T=W.options,U=0;U<T.length;U++){if(T[U].value==V){return T[U].innerHTML}}}function g(T){if(!T.currentActivity){T.activities.push({id:(T.currentActivity="new:".concat(++j)),name:"",description:{},criteria:[],certification:[],place:[]})}return h(T.activities,T.currentActivity)}function m(T){return T.checked}function I(T){if(T.target==this){this.firstChild.checked=!this.firstChild.checked;this.firstChild.emit("change")}}function O(V,T){var U=h(V,T.value);if(/^new:/.test(U.id)){V.splice(V.indexOf(U),1)}else{if(!/^remove:/.test(U.id)){U.id="remove:"+U.id}}T.options[T.selectedIndex--].remove();T.emit("change")}function l(T){T.selected=T.value==this?"selected":""}function M(T){if(T.checked){this.push(T.value)}}function v(T,X,W){for(var U=T.options,V=U.length;V--;){if(U[V].value==X){T.selectedIndex=V;U[V].selected=true;W.className="icon-"+X}else{U[V].selected=false}}}function y(T){if(T&&T.length){q.className=i.ok;this.trigger("search:place",{latitude:T[0].lat,longitude:T[0].lon})}else{if(/^[0-9][\w-]*|[0-9][\w-]*$/.test(Q.fields[0])){Q.fields[0]=Q.fields[0].replace(RegExp.lastMatch,"").replace(/[,;]/,"").trim();Q.call(this,Q.fields)}else{q.className=i.error}}}function Q(T,W){var U=T.join(", "),V,X;if(Q.address!=U){Q.address=U;Q.fields=T;X=J++;while(X--){d[r+X]=Object}d[r+J]=this.boundTo(y);V=document.body.appendChild(document.createElement("script"));V.on("load",V.remove).on("error",V.remove);V.type="text/javascript";V.src="http://nominatim.openstreetmap.org/search?format=json&json_callback="+r+J+"&q="+encodeURIComponent(U)}else{q.className=this.marker?i.ok:i.error}}function s(T){var U=T.map(k).filter(S);if(3<U.length){Q.call(this,U)}}function R(T){if(!T.currentPlace){T.place.push({id:(T.currentPlace="new:".concat(++j)),icon:"",latitude:null,longitude:null,road:"",extra:"",postcode:"",city:"",county:"",state:"",country:"",email:"",phone:"",website:"",twitter:"",facebook:""})}return h(T.place,T.currentPlace)}function S(T){return 0<T.length}function k(T){return T.value.trim()}function w(T){alert(["uhm, something does not seem right","----------------------------------",T.join("\n"),"----------------------------------","it looks like something is wrong with the data","please verify the following:","  1. every activity has at least one place","  2. there are no places without a location","  3. every place has at least 4 address fields","  4. every place has a specific icon"].join("\n"))}function p(U){var T=U.currentTarget;p.target[T.name]=T.value}function G(U,T,W){var V=T.length;U.latitude=T[V-2].value=W.latitude;U.longitude=T[V-1].value=W.longitude;return U}function E(U){var T=[];if(!n.test(U.email)){return T.push("wrong email address")&&T}return U.activities.every(z,T)||T.reverse()}function z(V,U,T){return(V.name.trim().length&&(T=Object.keys(V.description))&&T.length&&V.description[T[0]].trim().length&&(V.certification.length||3<V.criteria.length)&&((!V.place.length&&/^remove:/.test(V.id))||(V.place.length&&V.place.every(K,this)))&&!!V.id)||!this.push("[activity] "+(V.name||"?"))}function K(T){return(x.test(T.latitude)&&x.test(T.longitude)&&T.road.trim().length&&2<(T.postcode.trim().length+T.city.trim().length+T.county.trim().length+T.state.trim().length+T.country.trim().length)&&T.icon&&T.icon!="question"&&!!T.id)||!this.push("  "+(T.road||"?")+" - "+(T.postcode||"?"))}function B(T){T.place=c.pack(T.place);delete T.currentPlace}Object.keys(A).forEach(function(T){if(T!=="handleEvent"){this.on(T,this)}},A);$("fieldset").forEach(D.disable);A.trigger("step-1")})}(this));