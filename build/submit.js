/*! )°(, equolo - https://github.com/equolo/equolo.org */
/*@cc_on
(function(f){
window.setTimeout=f(window.setTimeout);
window.setInterval=f(window.setInterval);
})(function(f){return function(c,t,a){a=[].slice.call(arguments,2);return f(function(){c.apply(this,a)},t)}});
@*/
var
IEMobile=/*@cc_on/\bIEMobile\b/.test(navigator.userAgent)||@*/false,
IE9Mobile=/*@cc_on(IEMobile&&@_jscript_version<10)||@*/false,
IE10Mobile=/*@cc_on(IEMobile&&@_jscript_version/10>=1)||@*/false
;
IE9Mobile&&document.write('<link rel="stylesheet" href="css/IE9Mobile.css"/><script src="js/IE9Mobile.js"></script>');(function(d){
/*! display v0.1.3 - MIT license */
;var e=function(s){var j=s.Math,n=j.abs,u=j.max,r=j.min,y=s.Infinity,h=s.screen||y,g=d.matchMedia,o="addEventListener",x=s.document.documentElement,k=/\bMobile\b/.test(navigator.userAgent),p={change:[]},t={width:0,height:0,ratio:0,on:function(z,A){p[z].push(A)}},v=p.change.forEach||function(B,z){for(var A=0;A<this.length;A++){B.call(z,this[A],A,this)}},l;function m(z){z.call(t,t.width,t.height)}function q(z){if(l){clearTimeout(l)}l=setTimeout(i,300,z)}function i(F){l=0;var A=s.devicePixelRatio||1,E="orientation" in this,G=E?n(this.orientation||0)===90:!!g&&g("(orientation:landscape)").matches,B=h.width,D=h.height,C=r(s.innerWidth||x.clientWidth,A<1?y:((k&&G?u(B,D):B)||y)),z=r(s.innerHeight||x.clientHeight,A<1?y:((k&&G?r(B,D):D)||y));if(C!==t.width||z!==t.height){t.width=C;t.height=z;v.call(p.change,m)}}if(o in s){s[o]("orientationchange",q,true);s[o]("resize",q,true);try{h[o]("orientationchange",q,true)}catch(w){}}else{s.attachEvent("onresize",i)}i.call(s);t.ratio=s.devicePixelRatio||h.width/t.width||(h.deviceXDPI||1)/(h.logicalXDPI||1);return t}(d);(function(i,g,h){"indexOf" in i||(i.indexOf=function(j){for(var k=this.length;k--&&this[k]!==j;){}return k});"bind" in g||(g.bind=function(m){var l=this,k=i.slice,j=k.call(arguments,1);return function(){return l.apply(m,j.concat(k.call(arguments)))}});"trim" in h||(h.trim=function(){return this.replace(/^[^\S]+|[^\S]+$/g,"")})}(Array.prototype,Function.prototype,String.prototype));var c,b=c=function(p,i){function x(F){for(var A=F.length,G=n(A?F[0]:{}),B=G.length,H=p(A*B),E=0,D=0,C,z;E<A;++E){for(z=F[E],C=0;C<B;H[D++]=z[G[C++]]){}}return k.call([B],G,H)}function v(D){for(var E=D.length,A=D[0],z=p(((E-A-1)/A)||0),C=1+A,B=0,G,F;C<E;){for(z[B++]=(F={}),G=0;G<A;F[D[++G]]=D[C++]){}}return z}function j(A){return function z(G){for(var I=this,H=G,E=0,F=I.length,C,B,D;E<F;++E){if(m(D=H[B=I[E]])){C=E+1;H[B]=C<F?y.call(D,A,I.slice(C)):A(D)}H=H[B]}return G}}function l(A){return function z(H,F){for(var C=m(H),B=k.call(h,H),G=k.call(h,F),D=0,E=G.length;D<E;++D){B=y.call(B,A,G[D].split("."))}return C?B:B[0]}}function t(A,z){return z?o(A,z):x(A)}function g(z,A){return A?s(z,A):v(z)}function r(C,z,B,A){return w(t(C,A),z,B)}function q(A,z,B){return g(u(A,z),B)}var h=[],k=h.concat,n=Object.keys||function(B){var A=[],z;for(z in B){B.hasOwnProperty(z)&&A.push(z)}return A},m=p.isArray||(function(A,B){B=A.call(h);return function z(C){return A.call(C)==B}}({}.toString)),y=h.map||function(D,C){for(var A=this,B=A.length,z=p(B);B--;z[B]=D.call(C,A[B],B,A)){}return z},o=l(j(x)),s=l(j(v)),w=i.stringify,u=i.parse;return{pack:t,parse:q,stringify:r,unpack:g}}(Array,JSON);
/*! (C) WebReflection Mit Style License */
(function(z){function F(h){return typeof h=="string"?z.document.createTextNode(h):h}function m(p){if(p.length===1){return F(p[0])}for(var o=z.document.createDocumentFragment(),h=x.call(p),l=0;l<p.length;l++){o.appendChild(F(h[l]))}return o}for(var g,w,G,k=/^\s+|\s+$/g,E=/\s+/,C=" ",y=function(h,i){return this.contains(h)?i||this.remove(h):i&&this.add(h),!!i},q=(z.Element||z.Node||z.HTMLElement).prototype,B=["prepend",function(){var h=this.firstChild,i=m(arguments);h?this.insertBefore(i,h):this.appendChild(i)},"append",function(){this.appendChild(m(arguments))},"before",function(){var h=this.parentNode;h&&h.insertBefore(m(arguments),this)},"after",function(){var l=this.parentNode,n=this.nextSibling,h=m(arguments);l&&(n?l.insertBefore(h,n):l.appendChild(h))},"replace",function(){var h=this.parentNode;h&&h.replaceChild(m(arguments),this)},"remove",function(){var h=this.parentNode;h&&h.removeChild(this)}],x=B.slice,j=B.length;j;j-=2){g=B[j-2],g in q||(q[g]=B[j-1])}"classList" in document.documentElement?(G=document.createElement("div").classList,G.add("a","b"),"a b"!=G&&(q=G.constructor.prototype,"add" in q||(q=z.DOMTokenList.prototype),w=function(h){return function(){var i=0;while(i<arguments.length){h.call(this,arguments[i++])}}},q.add=w(q.add),q.remove=w(q.remove),q.toggle=y)):(w=function(h){if(!h){throw"SyntaxError"}if(E.test(h)){throw"InvalidCharacterError"}return h},G=function(i){var h=i.className.replace(k,"");h.length&&B.push.apply(this,h.split(E)),this._=i},G.prototype={length:0,add:function(){for(var h=0,i;h<arguments.length;h++){i=arguments[h],this.contains(i)||B.push.call(this,g)}this._.className=""+this},contains:function(h){return function(i){return j=h.call(this,g=w(i)),-1<j}}([].indexOf||function(h){j=this.length;while(j--&&this[j]!==h){}return j}),item:function(h){return this[h]||null},remove:function(){for(var h=0,i;h<arguments.length;h++){i=arguments[h],this.contains(i)&&B.splice.call(this,j,1)}this._.className=""+this},toggle:y,toString:function D(){return B.join.call(this,C)}},(Object.defineProperty||function(i,h,l){i.__defineGetter__(h,l.get)})(q,"classList",{get:function(){return new G(this)},set:function(){}}));try{new z.CustomEvent("?")}catch(A){z.CustomEvent=function(l,h){function o(t,p){var r=document.createEvent(l);if(typeof t!="string"){throw new Error("An event name must be provided")}return l=="Event"&&(r.initCustomEvent=i),p==null&&(p=h),r.initCustomEvent(t,p.bubbles,p.cancelable,p.detail),r}function i(u,p,v,s){this.initEvent(u,p,v),this.detail=s}return o}(z.CustomEvent?"CustomEvent":"Event",{bubbles:!1,cancelable:!1,detail:null})}})(d);
/*! (C) Andrea Giammarchi Mit Style License */
(function(aa){function H(){return{l:{},m:[],b:[]}}function q(h){var g=H();return ac.value=g,O(h,Z,ac),ac.value=null,g}function B(h,g,i){typeof g=="function"?g.apply(h,i):g.handleEvent.apply(g,i)}function j(h,g,i){i&&A(this,"detail",i),A(this,"type",g),A(this,"target",h),A(this,"timeStamp",R())}if(aa.eddy){return}aa.eddy=!0;var I=Array.prototype,Q=aa.prototype,M=j.prototype,W=Q.hasOwnProperty,J=I.push,P=I.slice,G=I.unshift,ae="toLocaleString",Z={toLocaleString:1}.propertyIsEnumerable(ae)?"_@eddy"+Math.random():ae,U=Z===ae,ac=(aa.create||aa)(null),X=[],O=U?function(h,g,i){h[g]=i.value}:aa.defineProperty,ab=function(h){var g=this;return function(){return g.apply(h,arguments)}},F=I.indexOf||function(h){var g=this.length;while(g--&&this[g]!==h){}return g},R=Date.now||function(){return(new Date).getTime()},Y={boundTo:function(i){var m=W.call(this,Z)?this[Z]:q(this),k=m.m,l=m.b,h=typeof i=="string"?this[i]:i,g=F.call(k,h);return g<0?l[J.call(k,h)-1]=ab.call(h,this):l[g]},emit:function(k){var v=W.call(this,Z),o=v&&this[Z].l,m=v&&W.call(o,k),i=m&&o[k],h=m&&P.call(arguments,1),g=0,p=m?i.length:g;while(g<p){B(this,i[g++],h)}return m},listeners:function(g){return W.call(this,Z)&&W.call(this[Z].l,g)&&this[Z].l[g].slice()||[]},off:function(h,m){var k=W.call(this,Z),i=k&&this[Z].l,l=k&&W.call(i,h)&&i[h],g;return l&&(g=F.call(l,m),-1<g&&(l.splice(g,1),l.length||delete i[h])),this},on:function(i,p,k){var m=W.call(this,Z),h=(m?this[Z]:q(this)).l,g=m&&W.call(h,i)?h[i]:h[i]=[];return F.call(g,p)<0&&(k?G:J).call(g,p),this},once:function(h,m,l){var g=function(i){k.off(h,g,l),B(k,m,arguments)},k=this;return k.on(h,g,l)},trigger:function(N,i){var S=W.call(this,Z),h=S&&this[Z].l,E=typeof N=="string",y=E?N:N.type,r=S&&W.call(h,y),x=r&&h[y].slice(0),g=E?new j(this,y,i):N,w=0,C=r?x.length:w,k=!(g instanceof j);k&&(g._active=!0,g.stopImmediatePropagation=M.stopImmediatePropagation),g.currentTarget=this,X[0]=g;while(g._active&&w<C){B(this,x[w++],X)}return k&&(delete g._active,delete g.stopImmediatePropagation),!g.defaultPrevented}},A=function(h,g,i){W.call(h,g)||(h[g]=i)},ad=!1,D;M.defaultPrevented=!1,M._active=M.cancelable=!0,M.preventDefault=function(){this.defaultPrevented=!0},M.stopImmediatePropagation=function(){this._active=!1};for(D in Y){W.call(Y,D)&&O(Q,D,{enumerable:!1,configurable:!0,writable:!0,value:Y[D]})}(function(h){function i(k){function l(m){m[k].apply(m,this)}return function(){return h.call(this,l,arguments),this}}for(var g in Y){Y.hasOwnProperty(g)&&!/^listeners|boundTo$/.test(g)&&O(I,g,{enumerable:!1,configurable:!0,writable:!0,value:i(g)})}})(I.forEach);var z={boundTo:Y.boundTo,data:function V(h,g){var i="dataset" in this;return arguments.length<2?i?this.dataset[h]:(g=this.getAttribute("data-"+h.replace(V.gre||(V.gre=/-[a-z]/g),V.gplace||(V.gplace=function(l,k){return k.toUpperCase()}))))==null?void 0:g:i?g==null?delete this.dataset[h]:(this.dataset[h]=g,g):(V.sre||(V.sre=/([a-z])([A-Z])/g,V.splace=function(l,k,m){return k+"-"+m.toLowerCase()}),h="data-"+h.replace(V.sre,V.splace),g==null?!this.removeAttribute(h):(this.setAttribute(h,g),g))},emit:function(h){var g=new CustomEvent(h);return g.arguments=I.slice.call(arguments,1),this.dispatchEvent(g)},listeners:function(g){return[]},off:function(h,g,i){return this.removeEventListener(h,g,i),this},on:function(h,g,i){return this.addEventListener(h,g,i),this},once:Y.once,trigger:function(h,m){var l=typeof h=="string",g=l?h:h.type,k=l?new CustomEvent(g,(ac.detail=m,ac)):h;return ac.detail=null,j.call(k,this,g),this.dispatchEvent(k)}};ac.cancelable=!0,ac.bubbles=!0;try{document.createEvent("Event").target=document}catch(K){ad=!0,A=function(i,g,k){if(!W.call(i,g)){try{i[g]=k}catch(h){}}}}(function(m){var i=m.Window,v=i?i.prototype:m,l=(m.Node||m.Element||m.HTMLElement).prototype,k=(m.Document||m.HTMLDocument).prototype,p=(m.XMLHttpRequest||function(){}).prototype,h,g;for(h in z){W.call(z,h)&&(g={enumerable:!1,configurable:!0,writable:!0,value:z[h]},O(v,h,g),O(l,h,g),O(k,h,g),h!=="data"&&O(p,h,g))}})(d)})(Object);d.$=function(g){return function(i,h){return g.slice.call(g.concat(h||document)[0].querySelectorAll(i))}}([]);
/*! SimpleKinetic v0.1.1 - MIT license */
;var a=function(h){var p=h.isNaN,i=h.Math,w=i.abs,v=i.round,s=i.sqrt,o=h.setInterval,t=h.clearInterval,k=0.2,u=9,q=1000/60,n=j.prototype;function j(x){for(var y in x){if(/^on|context|interval/.test(y)){this[y]=x[y]}}}n.init=function(O,N,E,C,H,F){var P=m(this),D=(w(E)<1?0:E)*(H?1:u),J=(w(C)<1?0:C)*(F?1:u),B=D*D,I=J*J,A=s(B+I),z=D/A,G=J/A,M,K;P.cancel(P._cx,P._cy);if(!(p(z)||p(G))){P._a=o(l,P.interval||q,P);P._t=0;P._d=A;P._sx=P._cx=O;P._sy=P._cy=N;P._xa=z;P._ya=G;M=v(O+A*z);K=v(N+A*G);P._ex=M;P._ey=K;if((O!==M||N!==K)&&P.start(O,N,0,0,M,K)!==false){return true}m(P._a)}return false};n.start=r("start");n.move=r("move");n.end=r("end");n.cancel=function(z,x,A,y,C,B){if(this._a){m(this).oncancel.call(this.context||this,z,x,A,y,C,B)}};n.onstart=n.onmove=n.onend=n.oncancel=function(z,x,A,y,C,B){};function m(x){t(x._a);x._a=0;return x}function r(x){x="on"+x;return function(A,y,B,z,D,C){return this[x].call(this.context||this,A,y,B,z,D,C)}}function l(A){var F=(A._t+=(A._d-A._t)*k),z=v(A._sx+F*A._xa),G=v(A._sy+F*A._ya),E=A._ex,C=A._ey,D=z-A._cx,B=G-A._cy;if(z===E&&G===C){m(A).end(E,C,D,B,E,C)}else{A.move(z,G,D,B,E,C);A._cx=z;A._cy=G}}var g=o(function(x){t(g);if(!x){o=function(A,z,y){return h.setInterval(function(){A(y)},z)}}},0,1);return j}(this);var f=function(h){var i=h.getContext("2d"),l={question:61736,"shopping-cart":61562,gift:61547,food:61685,home:61461,glass:61440,briefcase:61617,group:61632,truck:61649,"map-marker":32},g={};function k(o,q,p){i.beginPath();i.arc(o,q,p,0,Math.PI*2,true);i.closePath();i.fill()}function j(p,o){i.clearRect(0,0,h.width,h.height);h.width=h.height=o;i.textBaseline="bottom";i.fillStyle="rgb(25,138,138)";k(o/2,o/2.5,o/2.5);m(o,o/4.9);i.fillStyle="rgb(240,240,240)";k(o/2,o/2.5,o/2.8);i.font=i.mozTextStyle=Math.round(o/2)+"px FontAwesome";i.translate((h.width-(i.measureText||i.mozMeasureText).call(i,p).width)/2,0);i.fillStyle="rgb(40,104,104)";i.fillText(p,0,o/1.5);return h.toDataURL()}function m(o,p){i.beginPath();i.moveTo(o/2,o);i.lineTo(p,o/1.5);i.lineTo(o-p,o/1.5);i.lineTo(o/2,o);i.closePath();i.fill()}return function n(q,o,p){return g[q+o+p]||(g[q+o+p]=j(String.fromCharCode(l[q]),Math.round(o*(p||(typeof e==="undefined"?1:e.ratio)))))}}(document.createElement("canvas"));document.once("DOMContentLoaded",function(){var n=/^[^@]+?@[^\1@]+\.([a-z]{2,})$/,x=/^-?\d+(?:\.\d+)?$/,j=0,J=0,r="_JSONP",q=$("fieldset#step-4 fieldset.address > legend > i")[0],i={no:"icon-angle-down",ok:"icon-ok",error:"icon-exclamation-sign",searching:"icon-refresh icon-spin"},C={},z={handleEvent:function(U){var T=U.type,S;if("_type" in this){S=this._type+"-terminate";if(S in this){this[S](U)}}this._type=T;S=T+"-init";if(S in this){this[S](U)}D.enable($("fieldset#"+T)[0]);this[T](U)},"step-1":function(U){var T=$("fieldset#"+U.type)[0],S=$("select",T);S.once("change",function(){location.href=location.href.split(/[\?#]/)[0]+"?lang="+this.value});this.trigger("step-2")},"step-2":function(U){var T=$("fieldset#"+U.type)[0],S=$("input",T)[0];this.on("email:verified",N);S.on("keyup",this.boundTo(O));S.emit("keyup")},"step-3":function(ad){var ai=ad.detail,ag=$("fieldset"),ae=$("fieldset#"+ad.type)[0],T=$("select[name=activity]",ae)[0],aa=$("button[name=add]",ae)[0],ah=$("button[name=remove]",ae)[0],ab=$("button.next",ae)[0],ak=$("input[name=name]",ae)[0],ac=$("textarea[name=description]",ae)[0],aj=$("select[name=lang]",ae)[0],W=$("div.lang > p > span",ae)[0],X=$("ul",ae)[0],Z=$("div.criteria input",ae),U=Z.shift(),V=Z.shift(),S=function(am){var al=X.appendChild(document.createElement("li")),an=al.appendChild(document.createElement("strong"));an.append("√");al.append(an);al.append(" "+F(aj,am))},Y=function(){ah.disabled=!T.options.length;ab.disabled=aa.disabled=!(ac.value&&ak.value&&(m(U)||3<Z.filter(m).length));if(ab.disabled){if(this.hasOwnProperty("map")){ag.slice(ag.indexOf(ae)+1).forEach(D.disable)}}else{ab.emit("click")}}.bind(this),af;W.innerHTML=140;ak.value=ac.value=T.innerHTML=X.innerHTML="";T.on("change",this.onActivityChange||(this.onActivityChange=function(){ai.currentActivity=this.value;ad.currentTarget.trigger(ad)}));ak.on("keyup",this.onNameChange||(this.onNameChange=function(am){var an=ak.value.trim(),al=T.options[T.selectedIndex];g(ai).name=an;if(an){al.value=ai.currentActivity;al.innerHTML="";al.append(an)}Y()}));ac.on("keyup",this.onDescriptionChange||(this.onDescriptionChange=function(ap){var an=ac.value.trim(),am=parseInt(ac.getAttribute("maxlength"),10),ao=(am-an.length),al;if(ao<0){ao=0;ac.value=an.slice(0,am)}W.innerHTML=ao;al=g(ai).description;if(!(aj.value in al)){S(aj.value)}al[aj.value]=an;if(!an.length){delete al[aj.value];X.innerHTML="";Object.keys(al).forEach(S)}Y()}));aj.on("change",this.onLanguageDescriptionChange||(this.onLanguageDescriptionChange=function(am){var al=g(ai).description;ac.value=al[aj.value]||"";ac.emit("keyup")}));ai.activities.forEach(function(ao,am){if(/^remove:/.test(ao.id)){return}var an=T.appendChild(document.createElement("option")),al;an.value=ao.id;an.append(ao.name);if(!ai.hasOwnProperty("currentActivity")||ao.id==ai.currentActivity){ai.currentActivity=ao.id;an.selected="selected";ak.value=ao.name;al=Object.keys(ao.description);al.forEach.call(aj.options,l,al[0]);al.forEach(S);ac.value=ao.description[aj.value]||"";ac.emit("keyup")}},this);aa.on("click",this.onAnotherActivity||(this.onAnotherActivity=function(an){var al=T.options,ao;ai.currentActivity=null;T.appendChild(document.createElement("option")).append(ao=ak.placeholder||ak.getAttribute("placeholder"));ak.value=ac.value="";ac.emit("keyup");try{ak.focus()}catch(am){}Z.concat(V,U).forEach(function(ap){ap.checked=false});T.selectedIndex=al.length-1}));ah.on("click",this.onRemoveActivity||(this.onRemoveActivity=function(an){var am=g(ai),ao=am.id,al;if(/^new:/.test(ao)){ai.activities.splice(ai.activities.indexOf(am),1)}else{if(!/^remove:/.test(ao)){am.id="remove:"+ao;am.place=[]}}ai.currentActivity=null;T.selectedIndex--;T.emit("change")}));Z.on("change",this.onCriteriaChange||(this.onCriteriaChange=function(){Z.forEach(M,g(ai).criteria=[]);Y()}));af=ai.currentActivity?g(ai):{criteria:[],certification:[]};Z.forEach(function(al){al.checked=-1<this.criteria.indexOf(al.value);al.parentNode.on("click",I)},af);V.checked=0<af.criteria.length;U.checked=0<af.certification.length;V.on("change",this.enableAddRemoveButtons||(this.enableAddRemoveButtons=function(){if(V.checked){g(ai).certification=[]}Y()}));U.on("change",this.onCertifiedEnabled||(this.onCertifiedEnabled=function(){if(U.checked){g(ai).certification=[1]}Y()}));ab.on("click",this.onNextActivity||(this.onNextActivity=function(al){g(ai).currentPlace=null;this.trigger("step-4",ai)}.bind(this)));Y();if(aa.disabled&&ah.disabled){aa.emit("click")}},"step-4":function(af){var ak=af.detail,T=g(ak),U=T.currentPlace||!T.place.length?Q(T):T.place[0],ag=$("fieldset#"+af.type)[0],ae=$("i",ag)[0],V=$("select[name=place]",ag)[0],X=$("button[name=add]",ag)[0],aj=$("button[name=remove]",ag)[0],aa=$("button.next",ag)[0],ab=$("select[name=category]",ag)[0],S=$("div.map > button",ag)[0],Z=$("div.fields > input",ag),ai=[Z[0],Z[2],Z[3],Z[4],Z[5],Z[6]],W=[Z[0],Z[2]],Y=function(){aa.disabled=X.disabled=(U.latitude==null&&ae.value!="question");aj.disabled=V.options.length<2};q.className=i.no;T.currentPlace=U.id;this.hasExplicitPlace=false;$("fieldset",ag).forEach(D.enable);if(!this.hasOwnProperty("map")){L.tileLayer("http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg",{attribution:"Map Tiles &copy; Open MapQuest",maxZoom:18}).addTo(this.map=L.map("map"));this.setMapView=function ad(am,al){this.map.setView([am.latitude||am.lat,am.longitude||am.lng],al||Math.max(14,this.map.getZoom()))};this.setPlaceView=function ah(al){this.dropMarker();this.marker=L.marker([al.latitude||al.lat,al.longitude||al.lng],{icon:L.icon({iconUrl:f(ab.value,36),iconSize:[36,36]})}).addTo(this.map);this.setMapView(al);Y()};this.dropMarker=function(){if(this.marker){this.map.removeLayer(this.marker);this.marker=null}};this.setMapView(navigator.country.geo,5);V.on("change",function(){g(ak).currentPlace=this.value;af.currentTarget.trigger(af)});X.on("click",function(){var ao=g(ak),am=V.options,al=(ao.currentPlace=null)||Q(ao),an=V.appendChild(document.createElement("option"));an.append(" - ");an.value=al.id;V.selectedIndex=am.length-1;V.emit("change")});aj.on("click",function(){var am=g(ak),al=Q(am);if(/^new:/.test(al.id)){am.place.splice(am.place.indexOf(al),1)}else{if(!/^remove:/.test(id)){al.id="remove:"+al.id}}V.options[V.selectedIndex--].remove();V.emit("change")});ab.on("change",this.onCategoryChange||(this.onCategoryChange=function(al){ae.className="icon-"+ab.value;Q(g(ak)).icon=ab.value;if(this.marker){this.setPlaceView(this.marker.getLatLng())}}.bind(this)));aa.on("click",this.boundTo(function(){var al=E(ak);if(al===true){this.trigger("step-5",ak)}else{w(al)}}));ai.on("keyup",function(al){if(!this.hasExplicitPlace){clearTimeout(this.findPlaceTimer||0);q.className=i.searching;this.findPlaceTimer=setTimeout(this.boundTo(s),1000,ai)}}.bind(this));this.on("search:place",function(al){if(!this.hasExplicitPlace){this.setPlaceView(G(Q(g(ak)),Z,al.detail))}});$("#map").on("contextmenu",function ac(al){al.preventDefault();al.stopPropagation();if(this.hasExplicitPlace){P.address="";q.className=i.no;this.hasExplicitPlace=false;this.dropMarker()}else{if(this.askedUserIfPutAPlaceOnMap||confirm("would like to pin it here ?")){this.hasExplicitPlace=this.askedUserIfPutAPlaceOnMap=true;al=this.map.containerPointToLatLng(this.map.mouseEventToContainerPoint(al));if(!(isNaN(al.lat)||isNaN(al.lng))){this.setPlaceView(G(Q(g(ak)),Z,{latitude:al.lat,longitude:al.lng}));q.className=i.ok}}}}.bind(this));S.on("click",function(){S.disabled=true;try{navigator.geolocation.getCurrentPosition(function an(ao){this.setView([ao.coords.latitude,ao.coords.longitude],Math.max(14,this.getZoom()));S.disabled=false}.bind(this),function al(){S.disabled=false},{maximumAge:600000})}catch(am){}}.bind(this.map));W.on("keyup",function(){var al=V.options[V.selectedIndex];al.innerHTML="";al.append(W.map(k).join(" - "))})}this.dropMarker();while(V.options.length){V.options[0].remove()}T.place.forEach(function(al,am){if(/^remove:/.test(al.id)){return}var an=V.appendChild(document.createElement("option"));an.value=al.id;an.append(al.road+" - "+al.postcode);if(al.id==T.currentPlace){an.selected="selected";V.selectedIndex=am}});Z.forEach(function(al){var am=U&&U[al.name]||"";if(am.length&&al.name==="twitter"){am="@"+am}al.value=am});Z.on("keyup",p);p.target=U;v(ab,U.icon||ab.options[0].value,ae);Y();if(U.latitude!=null){this.setPlaceView(U)}},"step-5":function(W){var S=W.detail,V=$("fieldset#"+W.type)[0],T=$("div",V)[0],X=$("input[type=checkbox]",V)[0],U=$("input[type=submit]",V)[0];U.disabled=true;X.on("change",this.onAgreement||(this.onAgreement=function(){U.disabled=!this.checked}));U.on("click",this.onSaveAllTheData||(this.onSaveAllTheData=function(){var Y=E(S),aa,Z;if(Y===true){U.disabled=true;aa=JSON.parse(JSON.stringify(S));delete aa.currentActivity;aa.activities.forEach(B);console.log(JSON.stringify(aa));console.log(aa);Z=new XMLHttpRequest;Z.open("POST","cgi/create.php",true);Z.setRequestHeader("If-Modified-Since","Mon, 26 Jul 1997 05:00:00 GMT");Z.setRequestHeader("Cache-Control","no-cache");Z.setRequestHeader("X-Requested-With","XMLHttpRequest");Z.setRequestHeader("Content-Type","application/x-www-form-urlencoded");Z.on("readystatechange",function(){if(Z.readyState==4){$("fieldset").forEach(D.enable);switch(Z.responseText){case"OK":alert(")°(,");return location.reload();break;case"bad-data":alert("bad data");break;default:alert(Z.responseText||"connection error");break}U.disabled=false}});Z.send("info="+encodeURIComponent(JSON.stringify(aa)))}else{w(Y)}}))}},H=["mousedown","mousemove","mouseup","click"],D={disable:function(S){S.classList.add("disabled");H.forEach(D._addStopEvent,S)},enable:function(S){S.classList.remove("disabled");H.forEach(D._removeStopEvent,S)},_addStopEvent:function(S){this.on(S,t,true)},_removeStopEvent:function(S){this.off(S,t,true)}};function t(S){S.preventDefault();(S.stopImmediatePropagation||S.stopPropagation).call(S)}function o(S,T){var V=T.value.trim(),U=T.data("email"),W;if(n.test(V)&&V!==U){T.data("email",V);S.xhr=W=new XMLHttpRequest;W.target=S;W.open("get","cgi/verify.php?email="+encodeURIComponent(V),true);W.on("readystatechange",u).send(null);C.email=V}}function N(T){var S=T.detail;C.currentActivity=null;switch(typeof S){case"object":C.activities=S;if(C.activities.length){C.currentActivity=C.activities[0].id}break;case"boolean":if(confirm(jslang.seeYouLater)){}return location.href="http://equolo.org/";default:C.activities=[]}if(C.hasOwnProperty("activities")){this.trigger("step-3",C)}}function O(U){var S=U.currentTarget;C.email=null;try{this.xhr.abort()}catch(T){}clearTimeout(parseInt(S.data("timer")||0,10));if(n.test(S.value.trim())){S.data("timer",setTimeout(o,1000,this,S))}else{while(S=S.parentNode){if(S.nodeName==="FIELDSET"){$("fieldset").slice($("fieldset").indexOf(S)+1).forEach(D.disable);break}}}}function u(){if(this.readyState===4){this.target.trigger("email:verified",JSON.parse(this.responseText))}}function h(V,W){for(var T=0,U=V.length,S;T<U;T++){S=V[T];if(S.id==W){return S}}}function F(V,U){for(var S=V.options,T=0;T<S.length;T++){if(S[T].value==U){return S[T].innerHTML}}}function g(S){if(!S.currentActivity){S.activities.push({id:(S.currentActivity="new:".concat(++j)),name:"",description:{},criteria:[],certification:[],place:[]})}return h(S.activities,S.currentActivity)}function m(S){return S.checked}function I(S){if(S.target==this){this.firstChild.checked=!this.firstChild.checked;this.firstChild.emit("change")}}function l(S){S.selected=S.value==this?"selected":""}function M(S){if(S.checked){this.push(S.value)}}function v(S,W,V){for(var T=S.options,U=T.length;U--;){if(T[U].value==W){S.selectedIndex=U;T[U].selected=true;V.className="icon-"+W}else{T[U].selected=false}}}function y(S){if(S&&S.length){q.className=i.ok;this.trigger("search:place",{latitude:S[0].lat,longitude:S[0].lon})}else{if(/^[0-9][\w-]*|[0-9][\w-]*$/.test(P.fields[0])){P.fields[0]=P.fields[0].replace(RegExp.lastMatch,"").replace(/[,;]/,"").trim();P.call(this,P.fields)}else{q.className=i.error}}}function P(S,V){var T=S.join(", "),U,W;if(P.address!=T){P.address=T;P.fields=S;W=J++;while(W--){d[r+W]=Object}d[r+J]=this.boundTo(y);U=document.body.appendChild(document.createElement("script"));U.on("load",U.remove).on("error",U.remove);U.type="text/javascript";U.src="http://nominatim.openstreetmap.org/search?format=json&json_callback="+r+J+"&q="+encodeURIComponent(T)}else{q.className=this.marker?i.ok:i.error}}function s(S){var T=S.map(k).filter(R);if(3<T.length){P.call(this,T)}}function Q(S){if(!S.currentPlace){S.place.push({id:(S.currentPlace="new:".concat(++j)),icon:"",latitude:null,longitude:null,road:"",extra:"",postcode:"",city:"",county:"",state:"",country:"",email:"",phone:"",website:"",twitter:"",facebook:""})}return h(S.place,S.currentPlace)}function R(S){return 0<S.length}function k(S){return S.value.trim()}function w(S){alert(["uhm, something does not seem right","----------------------------------",S.join("\n"),"----------------------------------","it looks like something is wrong with the data","please verify the following:","  1. every activity has at least one place","  2. there are no places without a location","  3. every place has at least 4 address fields","  4. every place has a specific icon"].join("\n"))}function p(T){var S=T.currentTarget;p.target[S.name]=S.value}function G(T,S,V){var U=S.length;T.latitude=S[U-2].value=V.latitude;T.longitude=S[U-1].value=V.longitude;return T}function E(T){var S=[];if(!n.test(T.email)){return S.push("wrong email address")&&S}return T.activities.every(A,S)||S.reverse()}function A(U,T,S){return(U.name.trim().length&&(S=Object.keys(U.description))&&S.length&&U.description[S[0]].trim().length&&(U.certification.length||3<U.criteria.length)&&U.place.length&&U.place.every(K,this)&&!!U.id)||!this.push("[activity] "+(U.name||"?"))}function K(S){return(x.test(S.latitude)&&x.test(S.longitude)&&S.road.trim().length&&2<(S.postcode.trim().length+S.city.trim().length+S.county.trim().length+S.state.trim().length+S.country.trim().length)&&S.icon&&S.icon!="question"&&!!S.id)||!this.push("  "+(S.road||"?")+" - "+(S.postcode||"?"))}function B(S){S.place=c.pack(S.place);delete S.currentPlace}Object.keys(z).forEach(function(S){if(S!=="handleEvent"){this.on(S,this)}},z);$("fieldset").forEach(D.disable);z.trigger("step-1")})}(this));