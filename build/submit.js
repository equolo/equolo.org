/*! )°(, equolo - https://github.com/equolo/equolo.org */
/*@cc_on
(function(f){
window.setTimeout=f(window.setTimeout);
window.setInterval=f(window.setInterval);
})(function(f){return function(c,t,a){a=[].slice.call(arguments,2);return f(function(){c.apply(this,a)},t)}});
@*/
var
IEMobile=/*@cc_on/\bIEMobile\b/.test(navigator.userAgent)||@*/false,
IE9Mobile=/*@cc_on(IEMobile&&@_jscript_version<10)||@*/false,
IE10Mobile=/*@cc_on(IEMobile&&@_jscript_version/10>=1)||@*/false
;
IE9Mobile&&document.write('<link rel="stylesheet" href="css/IE9Mobile.css"/><script src="js/IE9Mobile.js"></script>');(function(e){
/*! display v0.1.8 - MIT license */
;var f=function(w){var l=w.Math,p=l.abs,y=l.max,v=l.min,D=w.Infinity,i=w.screen||D,h=w.matchMedia,q="addEventListener",r=w.document,C=r.documentElement,m=/\bMobile\b/.test(navigator.userAgent),j=C.requestFullscreen||C.mozRequestFullScreen||C.webkitRequestFullScreen,A=r.exitFullscreen||r.cancelFullscreen||r.mozCancelFullScreen||r.webkitExitFullscreen,s={change:[]},x={width:0,height:0,ratio:0,full:j&&A?function(E){var F=r.fullscreenElement||r.mozFullScreenElement||r.webkitFullscreenElement;if(E||E==null){x.fullScreen=true;if(!F){j.call(C)}}else{if(F){x.fullScreen=false;A.call(r)}}}:Object,on:function(E,F){s[E].push(F)}},z=s.change.forEach||function(G,E){for(var F=0;F<this.length;F++){G.call(E,this[F],F,this)}},n;function o(E){E.call(x,x.width,x.height)}function u(E){if(n){clearTimeout(n);n=0}return(!t()&&innerHeight<300)||(n=setTimeout(k,300,E))}function t(){return"orientation" in w?p(w.orientation||0)===90:!!h&&h("(orientation:landscape)").matches}function k(J){n=0;var F=w.devicePixelRatio||1,K=t(),G=i.width,I=i.height,H=v(w.innerWidth||C.clientWidth,F<1?D:((m&&K?y(G,I):G)||D)),E=v(w.innerHeight||C.clientHeight,F<1?D:((m&&K?v(G,I):I)||D));if(H!==x.width||E!==x.height){x.width=H;x.height=E;z.call(s.change,o)}}if(q in w){w[q]("orientationchange",u,true);w[q]("resize",u,true);try{i[q]("orientationchange",u,true)}catch(B){}}else{w.attachEvent("onresize",k)}k.call(w);x.ratio=w.devicePixelRatio||i.width/x.width||(i.deviceXDPI||1)/(i.logicalXDPI||1);return x}(e);(function(j,h,i){"bind" in h||(h.bind=function(n){var m=this,l=j.slice,k=l.call(arguments,1);return function(){return m.apply(n,k.concat(l.call(arguments)))}});"trim" in i||(i.trim=function(){return this.replace(/^[^\S]+|[^\S]+$/g,"")})}(Array.prototype,Function.prototype,String.prototype));var d,c=d=function(q,j){function y(G){for(var B=G.length,H=o(B?G[0]:{}),C=H.length,I=q(B*C),F=0,E=0,D,A;F<B;++F){for(A=G[F],D=0;D<C;I[E++]=A[H[D++]]){}}return l.call([C],H,I)}function w(E){for(var F=E.length,B=E[0],A=q(((F-B-1)/B)||0),D=1+B,C=0,H,G;D<F;){for(A[C++]=(G={}),H=0;H<B;G[E[++H]]=E[D++]){}}return A}function k(B){return function A(H){for(var J=this,I=H,F=0,G=J.length,D,C,E;F<G;++F){if(n(E=I[C=J[F]])){D=F+1;I[C]=D<G?z.call(E,B,J.slice(D)):B(E)}I=I[C]}return H}}function m(B){return function A(I,G){for(var D=n(I),C=l.call(i,I),H=l.call(i,G),E=0,F=H.length;E<F;++E){C=z.call(C,B,H[E].split("."))}return D?C:C[0]}}function u(B,A){return A?p(B,A):y(B)}function h(A,B){return B?t(A,B):w(A)}function s(D,A,C,B){return x(u(D,B),A,C)}function r(B,A,C){return h(v(B,A),C)}var i=[],l=i.concat,o=Object.keys||function(C){var B=[],A;for(A in C){C.hasOwnProperty(A)&&B.push(A)}return B},n=q.isArray||(function(B,C){C=B.call(i);return function A(D){return B.call(D)==C}}({}.toString)),z=i.map||function(E,D){for(var B=this,C=B.length,A=q(C);C--;A[C]=E.call(D,B[C],C,B)){}return A},p=m(k(y)),t=m(k(w)),x=j.stringify,v=j.parse;return{pack:u,parse:r,stringify:s,unpack:h}}(Array,JSON);
/*! (C) WebReflection Mit Style License */
(function(A){function G(h){return typeof h=="string"?A.document.createTextNode(h):h}function q(p){if(p.length===1){return G(p[0])}for(var o=A.document.createDocumentFragment(),h=y.call(p),l=0;l<p.length;l++){o.appendChild(G(h[l]))}return o}for(var j,x,H,m=/^\s+|\s+$/g,F=/\s+/,D=" ",z=function(h,i){return this.contains(h)?i||this.remove(h):i&&this.add(h),!!i},w=(A.Element||A.Node||A.HTMLElement).prototype,C=["prepend",function(){var h=this.firstChild,i=q(arguments);h?this.insertBefore(i,h):this.appendChild(i)},"append",function(){this.appendChild(q(arguments))},"before",function(){var h=this.parentNode;h&&h.insertBefore(q(arguments),this)},"after",function(){var l=this.parentNode,n=this.nextSibling,h=q(arguments);l&&(n?l.insertBefore(h,n):l.appendChild(h))},"replace",function(){var h=this.parentNode;h&&h.replaceChild(q(arguments),this)},"remove",function(){var h=this.parentNode;h&&h.removeChild(this)}],y=C.slice,k=C.length;k;k-=2){j=C[k-2],j in w||(w[j]=C[k-1])}"classList" in document.documentElement?(H=document.createElement("div").classList,H.add("a","b"),"a b"!=H&&(w=H.constructor.prototype,"add" in w||(w=A.DOMTokenList.prototype),x=function(h){return function(){var i=0;while(i<arguments.length){h.call(this,arguments[i++])}}},w.add=x(w.add),w.remove=x(w.remove),w.toggle=z)):(x=function(h){if(!h){throw"SyntaxError"}if(F.test(h)){throw"InvalidCharacterError"}return h},H=function(i){var h=i.className.replace(m,"");h.length&&C.push.apply(this,h.split(F)),this._=i},H.prototype={length:0,add:function(){for(var h=0,i;h<arguments.length;h++){i=arguments[h],this.contains(i)||C.push.call(this,j)}this._.className=""+this},contains:function(h){return function(i){return k=h.call(this,j=x(i)),-1<k}}([].indexOf||function(h){k=this.length;while(k--&&this[k]!==h){}return k}),item:function(h){return this[h]||null},remove:function(){for(var h=0,i;h<arguments.length;h++){i=arguments[h],this.contains(i)&&C.splice.call(this,k,1)}this._.className=""+this},toggle:z,toString:function E(){return C.join.call(this,D)}},(Object.defineProperty||function(i,h,l){i.__defineGetter__(h,l.get)})(w,"classList",{get:function(){return new H(this)},set:function(){}}));try{new A.CustomEvent("?")}catch(B){A.CustomEvent=function(l,h){function o(t,p){var r=document.createEvent(l);if(typeof t!="string"){throw new Error("An event name must be provided")}return l=="Event"&&(r.initCustomEvent=i),p==null&&(p=h),r.initCustomEvent(t,p.bubbles,p.cancelable,p.detail),r}function i(u,p,v,s){this.initEvent(u,p,v),this.detail=s}return o}(A.CustomEvent?"CustomEvent":"Event",{bubbles:!1,cancelable:!1,detail:null})}})(e);
/*! (C) Andrea Giammarchi Mit Style License */
(function(ar){function z(){return{w:{},l:{},m:[],b:[]}}function Z(i,h,j){typeof h=="function"?h.apply(i,j):h.handleEvent.apply(h,j)}function q(i,h,j){j!==void 0&&av(this,"detail",j),av(this,"type",h),av(this,"target",i),av(this,"timeStamp",aj())}if(ar.eddy){return}ar.eddy=!0;var ad=Array.prototype,ai=ar.prototype,af=q.prototype,an=ai.hasOwnProperty,ae=ad.push,ah=ad.slice,ac=ad.unshift,aw="toLocaleString",aq={toLocaleString:1}.propertyIsEnumerable(aw)?"_@eddy"+Math.random():aw,ak=aq===aw,au=(ar.create||ar)(null),ao=[],ag=ak?function(i,h,j){i[h]=j.value}:ar.defineProperty,at=function(i){var h=this;return function(){return h.apply(i,arguments)}},ab=ad.indexOf||function(i){var h=this.length;while(h--&&this[h]!==i){}return h},aj=Date.now||function(){return(new Date).getTime()},ap=function(i){var h=z();return au.value=h,ag(i,aq,au),au.value=null,h},Y={boundTo:function al(l,j){var p=an.call(this,aq)?this[aq]:ap(this),k=p.m,m=p.b,i=typeof l=="string"?typeof j===void 0||an.call(this,l)?this[l]:this[l]=j:l,h=ab.call(k,i);return h<0?m[ae.call(k,i)-1]=at.call(i,this):m[h]},emit:function K(p){var k=an.call(this,aq),v=k&&this[aq].l,o=k&&an.call(v,p),m=o&&v[p].slice(0),j=o&&ah.call(arguments,1),i=0,h=o?m.length:i;while(i<h){Z(this,m[i++],j)}return o},listeners:function X(h){return an.call(this,aq)&&an.call(this[aq].l,h)&&this[aq].l[h].slice()||[]},off:function G(k,h){var m=an.call(this,aq),j=m&&this[aq].l,i=m&&an.call(j,k)&&j[k],l;return i&&(l=ab.call(i,h),-1<l&&(i.splice(l,1),i.length||delete j[k])),this},on:function J(k,i,m){var j=an.call(this,aq),l=(j?this[aq]:ap(this)).l,h=j&&an.call(l,k)?l[k]:l[k]=[];return ab.call(h,i)<0&&(m?ac:ae).call(h,i),this},once:function ax(l,j,m){var k=function(i){h.off(l,k,m),Z(h,j,arguments)},h=this;return h.on(l,k,m)},trigger:function U(m,B){var j=an.call(this,aq),C=j&&this[aq].l,i=typeof m=="string",A=i?m:m.type,x=j&&an.call(C,A),k=x&&C[A].slice(0),w=i?new q(this,A,B):m,h=0,r=x?k.length:h,y=!(w instanceof q);y&&(w._active=!0,w.stopImmediatePropagation=af.stopImmediatePropagation),w.currentTarget=this,ao[0]=w;while(w._active&&h<r){Z(this,k[h++],ao)}return y&&(delete w._active,delete w.stopImmediatePropagation),!w.defaultPrevented},when:function(k,h){var l=an.call(this,aq),j=(l?this[aq]:ap(this)).w,i=l&&an.call(j,k);return i?(Z(this,h,j[k]),this):this.once(k,function(){an.call(j,k)||(j[k]=arguments)},!0).once(k,h)}},av=function(i,h,j){an.call(i,h)||(i[h]=j)},aa=!1,R;af.defaultPrevented=!1,af._active=af.cancelable=!0,af.preventDefault=function(){this.defaultPrevented=!0},af.stopImmediatePropagation=function(){this._active=!1};for(R in Y){an.call(Y,R)&&ag(ai,R,{enumerable:!1,configurable:!0,writable:!0,value:Y[R]})}(function(i){function j(k){function l(m){m[k].apply(m,this)}return function(){return i.call(this,l,arguments),this}}for(var h in Y){Y.hasOwnProperty(h)&&!/^listeners|boundTo$/.test(h)&&ag(ad,h,{enumerable:!1,configurable:!0,writable:!0,value:j(h)})}})(ad.forEach);var I={boundTo:function(i){try{i.call(document.createElement("div"),function(){})}catch(h){ap=function(j){return j[aq]=z(),j[aq]}}return i}(Y.boundTo),data:function F(j,h){var k="dataset" in this,i;return arguments.length<2?k?j in this.dataset?this.dataset[j]:i:(h=this.getAttribute("data-"+j.replace(F.gre||(F.gre=/-[a-z]/g),F.gplace||(F.gplace=function(m,l){return l.toUpperCase()}))))==null?i:h:k?h==null?delete this.dataset[j]:(this.dataset[j]=h,h):(F.sre||(F.sre=/([a-z])([A-Z])/g,F.splace=function(m,l,o){return l+"-"+o.toLowerCase()}),j="data-"+j.replace(F.sre,F.splace),h==null?!this.removeAttribute(j):(this.setAttribute(j,h),h))},emit:function Q(h){var i=new CustomEvent(h);return i.arguments=ad.slice.call(arguments,1),this.dispatchEvent(i)},listeners:function W(h){return[]},off:function(i,h,j){return this.removeEventListener(i,h,j),this},on:function(i,h,j){return this.addEventListener(i,h,j),this},once:Y.once,trigger:function am(l,j){var m=typeof l=="string",k=m?l:l.type,h=m?new CustomEvent(k,(au.detail=j,au)):l;return au.detail=null,q.call(h,this,k),this.dispatchEvent(h)},when:Y.when};au.cancelable=!0,au.bubbles=!0;try{document.createEvent("Event").target=document}catch(V){aa=!0,av=function(j,h,k){if(!an.call(j,h)){try{j[h]=k}catch(i){}}}}(function(x){var j=x.Window,h=j?j.prototype:x,y=(x.Node||x.Element||x.HTMLElement).prototype,i=(x.Document||x.HTMLDocument).prototype,w=(x.XMLHttpRequest||function(){}).prototype,v=function(){m.trigger("ready")},m=x.document,k,p;for(k in I){an.call(I,k)&&(p={enumerable:!1,configurable:!0,writable:!0,value:I[k]},ag(y,k,p),k!=="data"&&(ag(h,k,p),ag(i,k,p),ag(w,k,p)))}m.when("ready",ar),/loaded|complete/.test(m.readyState)?(x.setImmediate||setTimeout)(v):m.once("DOMContentLoaded",v,!0)})(e)})(Object);e.$=function(h){return function(j,i){return h.slice.call(h.concat(i||document)[0].querySelectorAll(j))}}([]);
/*! SimpleKinetic v0.1.1 - MIT license */
;var b=function(i){var q=i.isNaN,j=i.Math,x=j.abs,w=j.round,t=j.sqrt,p=i.setInterval,u=i.clearInterval,l=0.2,v=9,r=1000/60,o=k.prototype;function k(y){for(var z in y){if(/^on|context|interval/.test(z)){this[z]=y[z]}}}o.init=function(O,N,E,C,H,F){var P=n(this),D=(x(E)<1?0:E)*(H?1:v),J=(x(C)<1?0:C)*(F?1:v),B=D*D,I=J*J,A=t(B+I),z=D/A,G=J/A,M,K;P.cancel(P._cx,P._cy);if(!(q(z)||q(G))){P._a=p(m,P.interval||r,P);P._t=0;P._d=A;P._sx=P._cx=O;P._sy=P._cy=N;P._xa=z;P._ya=G;M=w(O+A*z);K=w(N+A*G);P._ex=M;P._ey=K;if((O!==M||N!==K)&&P.start(O,N,0,0,M,K)!==false){return true}n(P._a)}return false};o.start=s("start");o.move=s("move");o.end=s("end");o.cancel=function(A,y,B,z,D,C){if(this._a){n(this).oncancel.call(this.context||this,A,y,B,z,D,C)}};o.onstart=o.onmove=o.onend=o.oncancel=function(A,y,B,z,D,C){};function n(y){u(y._a);y._a=0;return y}function s(y){y="on"+y;return function(B,z,C,A,E,D){return this[y].call(this.context||this,B,z,C,A,E,D)}}function m(A){var F=(A._t+=(A._d-A._t)*l),z=w(A._sx+F*A._xa),G=w(A._sy+F*A._ya),E=A._ex,C=A._ey,D=z-A._cx,B=G-A._cy;if(z===E&&G===C){n(A).end(E,C,D,B,E,C)}else{A.move(z,G,D,B,E,C);A._cx=z;A._cy=G}}var h=p(function(y){u(h);if(!y){p=function(B,A,z){return i.setInterval(function(){B(z)},A)}}},0,1);return k}(this);function a(j,q,h,n){
/*! (C) equolo.org */
;var k=192,m=q/k,o=h||"#286868",i=j.getContext("2d");function p(r,s){i.moveTo(r*m,s*m)}function l(s,r,w,v,u,t){i.bezierCurveTo(s*m,r*m,w*m,v*m,u*m,t*m)}i.clearRect(0,0,j.width,j.height);j.width=j.height=q;if(n){i.fillStyle=n;i.fillRect(0,0,q,q)}i.fillStyle=o;i.save();i.scale(1.25,1.25);i.beginPath();p(95.32+10,10.21);l(101.05+10,7.85,108.56+10,12.68,108.09+10,19.01);l(108.39+10,25.61,100.46+10,30.49,94.67+10,27.28);l(87.81+10,24.1,88.04+10,12.79,95.32+10,10.21);i.closePath();i.fill();i.beginPath();p(67.01+10,7.48);l(72.33+10,20.59,82.54+10,31.7,95.46+10,37.57);l(104.17+10,41.72,113.89+10,43.25,123.47+10,43.1);l(108.12+10,48.29,96.34+10,60.6,88.32+10,74.31);l(79.91+10,88.85,78.34+10,106.86,83.29+10,122.84);l(72.84+10,106.64,59.08+10,91.84,41.39+10,83.57);l(30.55+10,78.74,18.41+10,76.4,6.58+10,77.64);l(24.52+10,73.08,42.99+10,65.59,54.74+10,50.61);l(64.15+10,38.49,68.55+10,22.74,67.01+10,7.48);i.closePath();i.fill();i.beginPath();p(43.22+10,119.97);l(43.75+10,102.87,43.89+10,94.92,48.72+10,89.2);l(50.5+10,93.22,49.73+10,97.67,50.54+10,101.88);l(51.34+10,107.31,53.13+10,112.93,57.29+10,116.73);l(61.3+10,121.01,68.71+10,121.41,70.94+10,127.44);l(72.27+10,133.19,66.42+10,138.03,61.08+10,138.09);l(54.7+10,138.64,49.47+10,133.66,46.69+10,128.39);l(43.41+10,122.84,43.52+10,116.2,43.22+10,109.97);i.closePath();i.fill();i.restore();return j}var g=function(i){var j=i.getContext("2d"),m={question:58202,briefcase:57945,food:57895,gift:57873,glass:57891,users:57752,home:57346,equolo:58880,"map-marker":58880,cart:57537,car:57949,tshirt:57757},h={};function l(p,s,q){j.beginPath();j.arc(p,s,q,0,Math.PI*2,true);j.closePath();j.fill()}function k(q,p){j.clearRect(0,0,i.width,i.height);i.width=i.height=p;j.textBaseline="bottom";j.fillStyle="rgb(25,138,138)";l(p/2,p/2.5,p/2.5);n(p,p/4.9);j.fillStyle="rgb(240,240,240)";l(p/2,p/2.5,p/2.8);j.font=j.mozTextStyle=Math.round(p/2)+"px equolo";j.fillStyle="rgb(40,104,104)";if(q.charAt(0)!="@"){j.translate((i.width-(j.measureText||j.mozMeasureText).call(j,q).width)/2,0);j.fillText(q,0,p/1.5)}else{j.drawImage((q==="@map-marker"?a:fashionIcon)(document.createElement("canvas"),p/1.5),p/7,p/10)}return i.toDataURL()}function n(p,q){j.beginPath();j.moveTo(p/2,p);j.lineTo(q,p/1.5);j.lineTo(p-q,p/1.5);j.lineTo(p/2,p);j.closePath();j.fill()}return function o(r,p,q){return h[r+p+q]||(h[r+p+q]=k(m.hasOwnProperty(r)?String.fromCharCode(m[r]):"@"+r,Math.round(p*(q||(typeof f==="undefined"?1:f.ratio)))))}}(document.createElement("canvas"));document.when("ready",function(){var o=/^[^@]+?@[^\1@]+\.([a-zA-Z]{2,})$/,y=/^-?\d+(?:\.\d+)?$/,k=0,N=0,s="_JSONP",r=$("fieldset#step-4 fieldset.address > legend > i")[0],j={no:"",ok:"icon-checkmark",error:"icon-close2",searching:"fx-spin icon-spinner"},E={},B={handleEvent:function(Y){var X=Y.type,W;if("_type" in this){W=this._type+"-terminate";if(W in this){this[W](Y)}}this._type=X;W=X+"-init";if(W in this){this[W](Y)}G.enable($("fieldset#"+X)[0]);this[X](Y)},"step-1":function(Y){var X=$("fieldset#"+Y.type)[0],W=$("select",X);W.once("change",function(){location.href=location.href.split(/[\?#]/)[0]+"?lang="+this.value});this.trigger("step-2");$("a").forEach(function(Z){if(-1<Z.href.indexOf("/categories")){Z.target="_blank"}})},"step-2":function(Y){var X=$("fieldset#"+Y.type)[0],W=$("input",X)[0];this.on("email:verified",Q);W.on("keyup",this.boundTo(S));W.emit("keyup")},"step-3":function(ah){var am=ah.detail,ak=$("fieldset"),ai=$("fieldset#"+ah.type)[0],X=$("select[name=activity]",ai)[0],ae=$("button[name=add]",ai)[0],al=$("button[name=remove]",ai)[0],af=$("button.next",ai)[0],ao=$("input[name=name]",ai)[0],ag=$("textarea[name=description]",ai)[0],an=$("select[name=lang]",ai)[0],aa=$("div.lang > p > span",ai)[0],ab=$("ul",ai)[0],ad=$("div.criteria input",ai),Y=ad.shift(),Z=ad.shift(),W=function(aq){var ap=ab.appendChild(document.createElement("li")),ar=ap.appendChild(document.createElement("strong"));ar.append("√");ap.append(ar);ap.append(" "+I(an,aq))},ac=function(){al.disabled=X.options.length<2;af.disabled=ae.disabled=!(ag.value&&ao.value&&(n(Y)||3<ad.filter(n).length));if(af.disabled){if(this.hasOwnProperty("map")){ak.slice(ak.indexOf(ai)+1).forEach(G.disable)}}else{af.emit("click")}}.bind(this),aj;aa.innerHTML=140;ao.value=ag.value=X.innerHTML=ab.innerHTML="";X.on("change",D(this,"onActivityChange",function(){am.currentActivity=this.value;ah.currentTarget.trigger(ah)}));ao.on("keyup",D(this,"onNameChange",function(aq){var ar=ao.value.trim(),ap=X.options[X.selectedIndex];h(am).name=ar;if(ar){ap.value=am.currentActivity;ap.innerHTML="";ap.append(ar)}ac()}));ag.on("keyup",D(this,"onDescriptionChange",function(au){var ar=ag.value.trim(),aq=parseInt(ag.getAttribute("maxlength"),10),at=(aq-ar.length),ap;if(at<0){at=0;ag.value=ar.slice(0,aq)}aa.innerHTML=at;ap=h(am).description;if(!(an.value in ap)){W(an.value)}ap[an.value]=ar;if(!ar.length){delete ap[an.value];ab.innerHTML="";Object.keys(ap).forEach(W)}ac()}));an.on("change",D(this,"onLanguageDescriptionChange",function(aq){var ap=h(am).description;ag.value=ap[an.value]||"";ag.emit("keyup")}));am.activities.forEach(function(at,aq){if(/^remove:/.test(at.id)){return}var ar=X.appendChild(document.createElement("option")),ap;ar.value=at.id;ar.append(at.name);if(!am.hasOwnProperty("currentActivity")||at.id==am.currentActivity){am.currentActivity=at.id;ar.selected="selected";ao.value=at.name;ap=Object.keys(at.description);ap.forEach.call(an.options,m,ap[0]);ap.forEach(W);ag.value=at.description[an.value]||"";ag.emit("keyup")}},this);ae.on("click",D(this,"onAnotherActivity",function(at){var ap=X.options,ar=!ap.length;am.currentActivity=null;X.appendChild(document.createElement("option")).append(" - ");X.disabled=ar;ao.value=ag.value="";ag.emit("keyup");try{ao.focus()}catch(aq){}ad.concat(Z,Y).forEach(function(au){au.checked=false});X.selectedIndex=ap.length-1}));al.on("click",D(this,"onRemoveActivity",function(ap){am.currentActivity=null;R(am.activities,X)}));ad.on("change",D(this,"onCriteriaChange",function(){ad.forEach(P,h(am).criteria=[]);ac()}));aj=am.currentActivity?h(am):{criteria:[],certification:[]};ad.forEach(function(ap){ap.checked=-1<this.criteria.indexOf(ap.value);ap.parentNode.on("click",M)},aj);Z.checked=0<aj.criteria.length;Y.checked=0<aj.certification.length;Z.on("change",D(this,"enableAddRemoveButtons",function(){if(Z.checked){h(am).certification=[]}ac()}));Y.on("change",D(this,"onCertifiedEnabled",function(){if(Y.checked){h(am).certification=[1]}ac()}));af.on("click",this.boundTo("onNextActivity",function(ap){h(am).currentPlace=null;this.trigger("step-4",am)}));ac();if(ae.disabled&&al.disabled){ae.emit("click")}},"step-4":function(aj){var ao=aj.detail,X=h(ao),Y=X.currentPlace||!X.place.length?U(X):X.place[0],ak=$("fieldset#"+aj.type)[0],ai=$("i",ak)[0],Z=$("select[name=place]",ak)[0],ab=$("button[name=add]",ak)[0],an=$("button[name=remove]",ak)[0],ae=$("button.next",ak)[0],af=$("select[name=category]",ak)[0],W=$("div.map > button",ak)[0],ad=$("div.fields > input",ak),am=[ad[0],ad[2],ad[3],ad[4],ad[5],ad[6]],aa=[ad[0],ad[2]],ac=function(){ae.disabled=ab.disabled=(Y.latitude==null&&ai.value!="question");an.disabled=Z.options.length<2};r.className=j.no;X.currentPlace=Y.id;this.hasExplicitPlace=false;$("fieldset",ak).forEach(G.enable);if(!this.hasOwnProperty("map")){L.tileLayer("http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg",{attribution:"Map Tiles &copy; Open MapQuest",maxZoom:18}).addTo(this.map=L.map("map"));this.setMapView=function ah(aq,ap){this.map.setView([aq.latitude||aq.lat,aq.longitude||aq.lng],ap||Math.max(14,this.map.getZoom()))};this.setPlaceView=function al(ap){this.dropMarker();this.marker=L.marker([ap.latitude||ap.lat,ap.longitude||ap.lng],{icon:L.icon({iconUrl:"/img/map/"+af.value+".png",iconSize:[36,36]})}).addTo(this.map);this.setMapView(ap);ac()};this.dropMarker=function(){if(this.marker){this.map.removeLayer(this.marker);this.marker=null}};this.setMapView(navigator.country.geo,5);Z.on("change",function(){h(ao).currentPlace=this.value;aj.currentTarget.trigger(aj)});ab.on("click",function(){var at=h(ao),aq=Z.options,ap=(at.currentPlace=null)||U(at),ar=Z.appendChild(document.createElement("option"));ar.append(" - ");ar.value=ap.id;Z.selectedIndex=aq.length-1;Z.emit("change")});an.on("click",function(){var ap=h(ao);ap.currentPlace=null;R(ap.place,Z)});af.on("change",this.onCategoryChange||(this.onCategoryChange=function(ap){ai.className="icon-"+af.value;U(h(ao)).icon=af.value;if(this.marker){this.setPlaceView(this.marker.getLatLng())}}.bind(this)));ae.on("click",this.boundTo(function(){var ap=F(ao);if(ap===true){this.trigger("step-5",ao)}else{x(ap)}}));am.on("keyup",function(ap){if(!this.hasExplicitPlace){clearTimeout(this.findPlaceTimer||0);this.findPlaceTimer=setTimeout(this.boundTo(t),1000,am)}}.bind(this));this.on("search:place",function(ap){if(!this.hasExplicitPlace){this.setPlaceView(J(U(h(ao)),ad,ap.detail))}});$("#map").on("contextmenu",function ag(ap){ap.preventDefault();ap.stopPropagation();if(this.hasExplicitPlace){T.address="";r.className=j.no;this.hasExplicitPlace=false;this.dropMarker()}else{if(this.askedUserIfPutAPlaceOnMap||confirm(jslang.pinit)){this.hasExplicitPlace=this.askedUserIfPutAPlaceOnMap=true;ap=this.map.containerPointToLatLng(this.map.mouseEventToContainerPoint(ap));if(!(isNaN(ap.lat)||isNaN(ap.lng))){this.setPlaceView(J(U(h(ao)),ad,{latitude:ap.lat,longitude:ap.lng}));r.className=j.ok}}}}.bind(this));W.on("click",function(){W.disabled=true;try{navigator.geolocation.getCurrentPosition(function ar(at){this.setView([at.coords.latitude,at.coords.longitude],Math.max(14,this.getZoom()));W.disabled=false}.bind(this),function ap(){W.disabled=false},{maximumAge:600000})}catch(aq){}}.bind(this.map));aa.on("keyup",function(){var ap=Z.options[Z.selectedIndex];ap.innerHTML="";ap.append(aa.map(l).join(" - "))})}this.dropMarker();while(Z.options.length){Z.options[0].remove()}X.place.forEach(function(ap,aq){if(/^remove:/.test(ap.id)){return}var ar=Z.appendChild(document.createElement("option"));ar.value=ap.id;ar.append(ap.address+" - "+ap.postcode);if(ap.id==X.currentPlace){ar.selected="selected";Z.selectedIndex=aq}});ad.forEach(function(ap){var aq=Y&&Y[ap.name]||"";if(aq.length&&ap.name==="twitter"){aq="@"+aq}ap.value=aq});ad.on("keyup",q);q.target=Y;w(af,Y.icon||af.options[0].value,ai);ac();if(Y.latitude!=null){this.setPlaceView(Y)}Z.disabled=Z.options.length<2},"step-5":function(aa){var W=aa.detail,Z=$("fieldset#"+aa.type)[0],X=$("div",Z)[0],ab=$("input[type=checkbox]",Z)[0],Y=$("input[type=submit]",Z)[0];Y.disabled=true;ab.on("change",D(this,"onAgreement",function(){Y.disabled=!this.checked}));Y.on("click",D(this,"onSaveAllTheData",function(){var ac=F(W),ae,ad;if(ac===true){Y.disabled=true;ae=JSON.parse(JSON.stringify(W));delete ae.currentActivity;ae.activities.forEach(C);ad=new XMLHttpRequest;ad.open("POST","cgi/create.php",true);ad.setRequestHeader("If-Modified-Since","Mon, 26 Jul 1997 05:00:00 GMT");ad.setRequestHeader("Cache-Control","no-cache");ad.setRequestHeader("X-Requested-With","XMLHttpRequest");ad.setRequestHeader("Content-Type","application/x-www-form-urlencoded");ad.on("readystatechange",function(){if(ad.readyState==4){$("fieldset").forEach(G.enable);switch(ad.responseText){case"OK":alert([jslang.everythingOK].concat(W.firstTimeInHere?jslang.oneStepLeft:[]).join("\n"));return W.firstTimeInHere?(location.href="http://equolo.org/"):location.reload();case"bad-data":alert("bad data");break;default:alert(ad.responseText||"connection error");break}Y.disabled=false}});ad.send("info="+encodeURIComponent(JSON.stringify(ae)))}else{x(ac)}}))}},K=["mousedown","mousemove","mouseup","click"],G={disable:function(W){W.classList.add("disabled");K.forEach(G._addStopEvent,W)},enable:function(W){W.classList.remove("disabled");K.forEach(G._removeStopEvent,W)},_addStopEvent:function(W){this.on(W,u,true)},_removeStopEvent:function(W){this.off(W,u,true)}};function u(W){W.preventDefault();(W.stopImmediatePropagation||W.stopPropagation).call(W)}function H(W){W.place=d.unpack(W.place)}function p(W,X){var Z=X.value.trim().toLowerCase(),Y=X.data("email"),aa;if(o.test(Z)&&Z!==Y){X.data("email",Z);W.xhr=aa=new XMLHttpRequest;aa.target=W;aa.open("get","cgi/verify.php?email="+encodeURIComponent(Z),true);aa.on("readystatechange",v).send(null);E.email=Z}}function Q(X){var W=X.detail;E.currentActivity=null;if(W==null){E.activities=[];E.firstTimeInHere=true}else{if(typeof W=="object"){E.activities=W;if(E.activities.length){E.activities.forEach(H);E.currentActivity=E.activities[0].id}}else{alert(jslang.pleaseConfirmFirst);return(location.href="http://equolo.org/")}}this.trigger("step-3",E)}function S(Y){var W=Y.currentTarget;E.email=null;try{this.xhr.abort()}catch(X){}clearTimeout(parseInt(W.data("timer")||0,10));if(o.test(W.value.trim())){W.data("timer",setTimeout(p,1000,this,W))}else{while(W=W.parentNode){if(W.nodeName==="FIELDSET"){$("fieldset").slice($("fieldset").indexOf(W)+1).forEach(G.disable);break}}}}function v(){if(this.readyState===4){this.target.trigger("email:verified",JSON.parse(this.responseText))}}function i(Z,aa){for(var X=0,Y=Z.length,W;X<Y;X++){W=Z[X];if(W.id==aa){return W}}}function I(Z,Y){for(var W=Z.options,X=0;X<W.length;X++){if(W[X].value==Y){return W[X].innerHTML}}}function h(W){if(!W.currentActivity){W.activities.push({id:(W.currentActivity="new:".concat(++k)),name:"",description:{},criteria:[],certification:[],place:[]})}return i(W.activities,W.currentActivity)}function n(W){return W.checked}function M(W){if(W.target==this){this.firstChild.checked=!this.firstChild.checked;this.firstChild.emit("change")}}function R(Y,W){var X=i(Y,W.value);if(/^new:/.test(X.id)){Y.splice(Y.indexOf(X),1)}else{if(!/^remove:/.test(X.id)){X.id="remove:"+X.id}}W.options[W.selectedIndex--].remove();W.emit("change")}function m(W){W.selected=W.value==this?"selected":""}function P(W){if(W.checked){this.push(W.value)}}function w(W,aa,Z){for(var X=W.options,Y=X.length;Y--;){if(X[Y].value==aa){W.selectedIndex=Y;X[Y].selected=true;Z.className="icon-"+aa}else{X[Y].selected=false}}}function z(W){if(W&&W.length){r.className=j.ok;this.trigger("search:place",{latitude:W[0].lat,longitude:W[0].lon})}else{if(/^[0-9][\w-]*|[0-9][\w-]*$/.test(T.fields[0])){T.fields[0]=T.fields[0].replace(RegExp.lastMatch,"").replace(/[,;]/,"").trim();T.call(this,T.fields)}else{r.className=j.error}}}function T(W,Z){var X=W.join(", "),Y,aa;if(T.address!=X){T.address=X;T.fields=W;aa=N++;while(aa--){e[s+aa]=Object}e[s+N]=this.boundTo(z);Y=document.body.appendChild(document.createElement("script"));Y.on("load",Y.remove).on("error",Y.remove);Y.type="text/javascript";Y.src="http://nominatim.openstreetmap.org/search?format=json&json_callback="+s+N+"&q="+encodeURIComponent(X)}else{r.className=this.marker?j.ok:j.error}}function t(W){var X=W.map(l).filter(V);if(3<X.length){r.className=j.searching;T.call(this,X)}}function U(W){if(!W.currentPlace){W.place.push({id:(W.currentPlace="new:".concat(++k)),icon:"",latitude:null,longitude:null,address:"",extra:"",postcode:"",city:"",county:"",state:"",country:"",email:"",phone:"",website:"",twitter:"",gplus:"",facebook:""})}return i(W.place,W.currentPlace)}function V(W){return 0<W.length}function l(W){return W.value.trim()}function x(W){alert(["uhm, something does not seem right","----------------------------------",W.join("\n"),"----------------------------------","it looks like something is wrong with the data","please verify the following:","  1. every activity has at least one place","  2. there are no places without a location","  3. every place has at least 4 address fields","  4. every place has a specific icon"].join("\n"))}function q(X){var W=X.currentTarget;q.target[W.name]=W.value}function J(X,W,Z){var Y=W.length;X.latitude=W[Y-2].value=Z.latitude;X.longitude=W[Y-1].value=Z.longitude;return X}function F(X){var W=[];if(!o.test(X.email)){return W.push("wrong email address")&&W}return X.activities.every(A,W)||W.reverse()}function A(Y,X,W){return(Y.name.trim().length&&(W=Object.keys(Y.description))&&W.length&&Y.description[W[0]].trim().length&&(Y.certification.length||3<Y.criteria.length)&&((!Y.place.length&&/^remove:/.test(Y.id))||(Y.place.length&&Y.place.every(O,this)))&&!!Y.id)||!this.push("[activity] "+(Y.name||"?"))}function O(W){return(y.test(W.latitude)&&y.test(W.longitude)&&W.address.trim().length&&3<(W.postcode.trim().length+W.city.trim().length+W.county.trim().length+W.state.trim().length+W.country.trim().length)&&W.icon&&W.icon!="question"&&!!W.id)||!this.push("  "+(W.address||"?")+" - "+(W.postcode||"?"))}function C(W){W.place=d.pack(W.place);delete W.currentPlace}function D(W,Y,X){return W[Y]||(W[Y]=X)}Object.keys(B).forEach(function(W){if(W!=="handleEvent"){this.on(W,this)}},B);$("fieldset").forEach(G.disable);B.trigger("step-1")})}(this));